<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparative Medicine Database</title>
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Add in the <head> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body>
    <!-- Navigation Bar with Sign Up Form -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Comparative Medicine Database</a>

            <!-- Navigation Links -->
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">About Us</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#helpModal">Help</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a>
            </div>

            <!-- Sign Up Form in Top Right -->
            <div class="d-flex align-items-center">
                <button type="button" class="btn btn-outline-light me-2" onclick="showCart()">
                    🛒 Cart (<span id="cartCount">0</span>)
                </button>
                
                <!-- User greeting (hidden by default) -->
                <div id="userGreeting" class="text-white me-3" style="display: none;">
                    Welcome, <span id="userName"></span>!
                </div>
                
                <!-- Authentication buttons -->
                <div id="authButtons">
                    <button type="button" class="btn btn-outline-light me-2" data-bs-toggle="modal"
                        data-bs-target="#signinModal">
                        Sign In
                    </button>
                    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal"
                        data-bs-target="#signupModal">
                        Sign Up
                    </button>
                </div>
                
                <!-- Sign out button (hidden by default) -->
                <button type="button" class="btn btn-outline-light" id="signoutBtn" onclick="signOut()" style="display: none;">
                    Sign Out
                </button>
            </div>
        </div>
    </nav>

    <!-- Sign Up Modal -->
    <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signupModalLabel">Sign Up</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signupForm">
                        <div class="mb-3">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="mb-3">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitSignup()">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal fade" id="signinModal" tabindex="-1" aria-labelledby="signinModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signinModalLabel">Sign In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signinForm">
                        <div class="mb-3">
                            <label for="signinEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="signinEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="signinPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="signinPassword" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Remember me
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitSignin()">Sign In</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Us Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aboutModalLabel">About Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Our Mission</h6>
                    <p>The Comparative Medicine Database is dedicated to advancing medical research through
                        comprehensive data collection and analysis across different species and treatment methodologies.
                    </p>

                    <h6>What We Do</h6>
                    <p>We provide researchers, veterinarians, and medical professionals with access to comparative
                        medicine data to improve understanding of diseases, treatments, and outcomes across various
                        animal models and human applications.</p>

                    <h6>Our Team</h6>
                    <p>Our team consists of experienced researchers, data scientists, and medical professionals
                        committed to advancing the field of comparative medicine.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Us Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="contactSubject" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                        </div>
                    </form>

                    <hr>

                    <h6>Other Ways to Reach Us</h6>
                    <p><strong>Email:</strong> info@comparativemedicine.com</p>
                    <p><strong>Phone:</strong> (555) 123-4567</p>
                    <p><strong>Address:</strong> 123 Research Drive, Medical Center, State 12345</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitContact()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Help & Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="accordion" id="helpAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    How to get started?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    To get started, create an account by clicking the "Sign Up" button. Once registered,
                                    you can access our database of comparative medicine research and contribute your own
                                    data.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    How to search the database?
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    Use the search function to find specific studies, diseases, treatments, or animal
                                    models. You can filter results by species, treatment type, study date, and other
                                    criteria.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    How to submit data?
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    Registered users can submit research data through our submission portal. All
                                    submissions are reviewed for quality and relevance before being added to the
                                    database.
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="mt-4">

                    <h6>Still need help?</h6>
                    <p>If you can't find what you're looking for, please contact our support team using the Contact Us
                        form.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="terms-content">
                        <h6>1. Acceptance of Terms</h6>
                        <p>By accessing and using the Comparative Medicine Database website and services, you agree to be bound by these Terms and Conditions. If you do not agree with any part of these terms, you may not use our services.</p>

                        <h6>2. Description of Service</h6>
                        <p>The Comparative Medicine Database provides access to information about medicines and treatments for both humans and animals. This platform is designed for educational and research purposes to facilitate comparative medicine studies.</p>

                        <h6>3. User Responsibilities</h6>
                        <ul>
                            <li>You are responsible for maintaining the confidentiality of your account credentials</li>
                            <li>You agree to provide accurate and current information when creating an account</li>
                            <li>You will not use the service for any unlawful or prohibited activities</li>
                            <li>You will not attempt to gain unauthorized access to any part of the service</li>
                        </ul>

                        <h6>4. Medical Disclaimer</h6>
                        <p><strong>Important:</strong> The information provided in this database is for educational and research purposes only. It is not intended as medical advice, diagnosis, or treatment. Always consult with qualified healthcare professionals or veterinarians before making any medical decisions for yourself or your animals.</p>

                        <h6>5. Data Accuracy and Liability</h6>
                        <p>While we strive to provide accurate information, we make no warranties about the completeness, reliability, or accuracy of the data. Users should verify all information with appropriate medical professionals before use.</p>

                        <h6>6. Privacy and Data Protection</h6>
                        <p>We are committed to protecting your privacy. Personal information collected through this service will be handled in accordance with applicable data protection laws. We do not sell or share personal information with third parties without consent.</p>

                        <h6>7. Intellectual Property</h6>
                        <p>The content, design, and functionality of this website are protected by copyright and other intellectual property laws. Users may not reproduce, distribute, or create derivative works without written permission.</p>

                        <h6>8. Shopping Cart and Payment</h6>
                        <p>The shopping cart feature is provided for demonstration purposes only. Any transactions are simulated and no actual payments are processed. Real medicine purchases should only be made through licensed pharmacies and veterinary clinics.</p>

                        <h6>9. Prohibited Uses</h6>
                        <p>You may not use this service to:</p>
                        <ul>
                            <li>Engage in illegal activities or promote illegal substances</li>
                            <li>Distribute malware, viruses, or harmful code</li>
                            <li>Harass, abuse, or harm other users</li>
                            <li>Impersonate others or provide false information</li>
                            <li>Attempt to circumvent security measures</li>
                        </ul>

                        <h6>10. Limitation of Liability</h6>
                        <p>The Comparative Medicine Database and its operators shall not be liable for any direct, indirect, incidental, special, or consequential damages resulting from the use or inability to use this service.</p>

                        <h6>11. Changes to Terms</h6>
                        <p>We reserve the right to modify these terms at any time. Users will be notified of significant changes, and continued use of the service constitutes acceptance of the modified terms.</p>

                        <h6>12. Termination</h6>
                        <p>We may terminate or suspend access to the service immediately, without prior notice, for any breach of these Terms and Conditions.</p>

                        <h6>13. Governing Law</h6>
                        <p>These terms shall be governed by and construed in accordance with the laws of the jurisdiction in which the service operates.</p>

                        <h6>14. Contact Information</h6>
                        <p>If you have questions about these Terms and Conditions, please contact us through the Contact Us form on our website.</p>

                        <hr class="mt-4">
                        <p class="text-muted"><small>Last updated: July 6, 2025</small></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Medicine Details Modal -->
    <div class="modal fade" id="medicineDetailsModal" tabindex="-1" aria-labelledby="medicineDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="medicineDetailsModalLabel">Medicine Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="medicineDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Purchase Medicine</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Order Summary</h6>
                            <div id="orderSummary">
                                <!-- Order details will be populated here -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Payment Information</h6>
                            <form id="paymentForm">
                                <div class="mb-3">
                                    <label for="cardNumber" class="form-label">Card Number</label>
                                    <input type="text" class="form-control" id="cardNumber"
                                        placeholder="1234 5678 9012 3456" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="expiryDate" class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY"
                                            required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="text" class="form-control" id="cvv" placeholder="123" required>
                                    </div>
                                </div>
                                <div class="mb-3 mt-3">
                                    <label for="cardName" class="form-label">Cardholder Name</label>
                                    <input type="text" class="form-control" id="cardName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="billingAddress" class="form-label">Billing Address</label>
                                    <textarea class="form-control" id="billingAddress" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="quantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="quantity" min="1" value="1"
                                        onchange="updateTotal()">
                                </div>
                                <div class="mb-3">
                                    <h5>Total: £<span id="totalAmount">0.00</span></h5>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="processPayment()">
                        <i class="bi bi-credit-card"></i> Pay Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">Shopping Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems">
                        <!-- Cart items will be populated here -->
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <h5>Total: £<span id="cartTotal">0.00</span></h5>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                    <button type="button" class="btn btn-primary" onclick="proceedToCheckout()" id="checkoutBtn"
                        disabled>
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <h1>Welcome to Comparative Medicine Database</h1>
        <p>This is a comprehensive database for comparative medicine research and treatments.</p>
        <p>Browse through our collection of medicines and their applications across different species.</p>

        <!-- Patient Information Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-user-md"></i> Patient Information
                        </h4>
                        <small>Please provide your information for personalized medicine recommendations and safety warnings</small>
                    </div>
                    <div class="card-body">
                        <form id="patientInfoForm">
                            <div class="row">
                                <!-- Age -->
                                <div class="col-md-3">
                                    <label for="patientAge" class="form-label"><strong>Age:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientAge" min="0" max="120" placeholder="Enter age">
                                        <span class="input-group-text">years</span>
                                    </div>
                                    <div class="form-text">Age affects dosage and safety</div>
                                </div>
                                
                                <!-- Weight -->
                                <div class="col-md-3">
                                    <label for="patientWeight" class="form-label"><strong>Weight:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientWeight" min="1" max="300" step="0.1" placeholder="Enter weight">
                                        <select class="form-select" id="weightUnit" style="max-width: 80px;">
                                            <option value="kg">kg</option>
                                            <option value="lbs">lbs</option>
                                        </select>
                                    </div>
                                    <div class="form-text">Weight-based dosing calculations</div>
                                </div>
                                
                                <!-- Height -->
                                <div class="col-md-3">
                                    <label for="patientHeight" class="form-label"><strong>Height:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientHeight" min="50" max="250" placeholder="Enter height">
                                        <select class="form-select" id="heightUnit" style="max-width: 80px;">
                                            <option value="cm">cm</option>
                                            <option value="ft">ft</option>
                                        </select>
                                    </div>
                                    <div class="form-text">For BMI and surface area calculations</div>
                                </div>
                                
                                <!-- Allergies -->
                                <div class="col-md-3">
                                    <label for="patientAllergies" class="form-label"><strong>Known Allergies:</strong></label>
                                    <textarea class="form-control" id="patientAllergies" rows="2" placeholder="e.g., Penicillin, Aspirin, Sulfa"></textarea>
                                    <div class="form-text">Critical for safety warnings</div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="row mt-3">
                                <div class="col-12 text-center">
                                    <button type="button" class="btn btn-primary me-2" onclick="savePatientInfo()">
                                        <i class="fas fa-save"></i> Save Information
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary me-2" onclick="clearPatientInfo()">
                                        <i class="fas fa-eraser"></i> Clear
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="calculateBMI()">
                                        <i class="fas fa-calculator"></i> Calculate BMI
                                    </button>
                                </div>
                            </div>
                            
                            <!-- BMI Display -->
                            <div class="row mt-3" id="bmiSection" style="display: none;">
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <strong>BMI: </strong><span id="bmiValue"></span> - <span id="bmiCategory"></span>
                                        <br><small id="bmiNote"></small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Safety Alerts -->
                            <div class="row mt-3" id="safetyAlerts" style="display: none;">
                                <div class="col-12">
                                    <div class="alert alert-warning">
                                        <strong><i class="fas fa-exclamation-triangle"></i> Safety Alerts:</strong>
                                        <ul id="alertsList" class="mb-0 mt-2"></ul>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medicine Display Section -->
        <div class="row mt-5">
            <div class="col-12">
                <h2 class="mb-4">Featured Medicines</h2>

                <!-- Medicine Selection and Filter Section -->
                <div class="mb-4">
                    <div class="row">
                        <!-- Species Filter (First) -->
                        <div class="col-md-2">
                            <label for="speciesFilter" class="form-label"><strong>Species:</strong></label>
                            <select class="form-select" id="speciesFilter" onchange="filterBySpecies()">
                                <option value="">All Species</option>
                                <option value="Humans">Humans</option>
                                <option value="Dogs">Dogs</option>
                                <option value="Cats">Cats</option>
                                <option value="Dogs, Cats">Dogs & Cats</option>
                                <option value="Horses">Horses</option>
                                <option value="Cattle">Cattle</option>
                                <option value="Horses, Cattle">Horses & Cattle</option>
                                <option value="Sheep">Sheep</option>
                                <option value="Pigs">Pigs</option>
                                <option value="Goats">Goats</option>
                                <option value="Rabbits">Rabbits</option>
                                <option value="Exotic Animals">Exotic Animals</option>
                            </select>
                        </div>
                        <!-- Category Filter (Second) -->
                        <div class="col-md-2">
                            <label for="categoryFilter" class="form-label"><strong>Category:</strong></label>
                            <select class="form-select" id="categoryFilter" onchange="filterByCategory()">
                                <option value="">All Categories</option>
                                <option value="Antibiotic">Antibiotics</option>
                                <option value="Pain Reliever">Pain Relievers</option>
                                <option value="NSAID">NSAIDs</option>
                                <option value="Anti-inflammatory">Anti-inflammatory</option>
                                <option value="Diabetes Medication">Diabetes Medications</option>
                                <option value="ACE Inhibitor">ACE Inhibitors</option>
                                <option value="Statin">Statins</option>
                                <option value="Proton Pump Inhibitor">Proton Pump Inhibitors</option>
                                <option value="Corticosteroid">Corticosteroids</option>
                                <option value="Bronchodilator">Bronchodilators</option>
                                <option value="Diuretic">Diuretics</option>
                                <option value="Antiparasitic">Antiparasitics</option>
                                <option value="Topical Antiparasitic">Topical Antiparasitics</option>
                                <option value="Heartworm Preventive">Heartworm Preventives</option>
                                <option value="Joint Supplement">Joint Supplements</option>
                                <option value="Cardiac Glycoside">Cardiac Glycosides</option>
                                <option value="Antiemetic">Antiemetics</option>
                                <option value="H2 Receptor Antagonist">H2 Antagonists</option>
                                <option value="Immunosuppressant">Immunosuppressants</option>
                                <option value="Anthelmintic">Anthelmintics</option>
                                <option value="Topical Insecticide">Topical Insecticides</option>
                                <option value="Opioid Analgesic">Opioid Analgesics</option>
                                <option value="Anesthetic">Anesthetics</option>
                                <option value="Tranquilizer">Tranquilizers</option>
                                <option value="SSRI">SSRIs</option>
                                <option value="Thyroid Hormone">Thyroid Hormones</option>
                                <option value="Antithyroid">Antithyroid</option>
                                <option value="Insulin">Insulin</option>
                                <option value="Inodilator">Inodilators</option>
                                <option value="Chemotherapy">Chemotherapy</option>
                            </select>
                        </div>
                        <!-- Medicine Selection (Third) -->
                        <div class="col-md-4">
                            <label for="medicineSelect" class="form-label"><strong>Select a Medicine:</strong></label>
                            <select class="form-select" id="medicineSelect" onchange="selectMedicine()">
                                <option value="">Choose a medicine...</option>
                                <option value="loading" disabled>Loading medicines...</option>
                            </select>
                        </div>
                        <!-- Action Buttons -->
                        <div class="col-md-2">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-danger btn-sm" onclick="clearAllFilters()">
                                    <i class="fas fa-times"></i> Clear Filters
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="loadAllMedicines()">
                                    <i class="fas fa-list"></i> Show All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Add to Cart Section -->
                    <div class="row mt-3" id="addToCartSection" style="display: none;">
                        <div class="col-md-12">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="fas fa-shopping-cart"></i> Selected Medicine Details & Add to Cart</h6>
                                </div>
                                <div class="card-body">
                                    <!-- Basic Medicine Information -->
                                    <div class="row mb-3">
                                        <div class="col-md-8">
                                            <div id="selectedMedicineInfo">
                                                <h5 class="text-primary mb-2">
                                                    <i class="fas fa-pills"></i> <span id="selectedMedicineName">None</span>
                                                </h5>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <small class="text-muted"><strong>Category:</strong> <span id="selectedMedicineCategory">-</span></small><br>
                                                        <small class="text-muted"><strong>Species:</strong> <span id="selectedMedicineSpecies">-</span></small><br>
                                                        <small class="text-info"><strong>Dosage:</strong> <span id="selectedMedicineDosage">-</span></small>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="fw-bold text-success fs-5">£<span id="selectedMedicinePrice">0.00</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-6">
                                                    <label for="quantitySelect" class="form-label"><strong>Quantity:</strong></label>
                                                    <select class="form-select" id="quantitySelect">
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                        <option value="10">10</option>
                                                    </select>
                                                </div>
                                                <div class="col-6">
                                                    <label class="form-label">&nbsp;</label>
                                                    <div class="d-grid">
                                                        <button class="btn btn-primary" onclick="addSelectedMedicineToCart()">
                                                            <i class="fas fa-cart-plus"></i> Add to Cart
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Comprehensive Formula Section -->
                                    <div class="card border-info mt-3" id="formulaSection">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0"><i class="fas fa-flask"></i> Comprehensive Formula & Chemical Information</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <!-- Chemical Formula -->
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Molecular Formula:</strong>
                                                        <div class="bg-light p-2 rounded">
                                                            <code id="molecularFormula" class="fs-6">-</code>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Molecular Weight:</strong>
                                                        <div class="text-muted" id="molecularWeight">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Chemical Name:</strong>
                                                        <div class="text-muted" id="chemicalName">-</div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Pharmacological Information -->
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Mechanism of Action:</strong>
                                                        <div class="text-muted small" id="mechanismOfAction">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Therapeutic Class:</strong>
                                                        <div class="text-muted" id="therapeuticClass">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Route of Administration:</strong>
                                                        <div class="text-muted" id="routeOfAdmin">-</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Pharmacokinetics -->
                                            <div class="row mt-3">
                                                <div class="col-md-12">
                                                    <h6 class="text-primary border-bottom pb-1">
                                                        <i class="fas fa-heartbeat"></i> Pharmacokinetics
                                                    </h6>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Absorption:</strong>
                                                    <div class="text-muted small" id="absorption">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Distribution:</strong>
                                                    <div class="text-muted small" id="distribution">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Metabolism:</strong>
                                                    <div class="text-muted small" id="metabolism">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Elimination:</strong>
                                                    <div class="text-muted small" id="elimination">-</div>
                                                </div>
                                            </div>
                                            
                                            <!-- Additional Information -->
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <strong class="text-primary">Contraindications:</strong>
                                                    <div class="text-danger small" id="contraindications">-</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <strong class="text-primary">Side Effects:</strong>
                                                    <div class="text-warning small" id="sideEffects">-</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Bar (Fourth/Last) -->
                <div class="mb-4">
                    <div class="input-group">
                        <input type="text" class="form-control" id="medicineSearch"
                            placeholder="Search medicines by name, category, or species...">
                        <button class="btn btn-outline-secondary" type="button" onclick="searchMedicines()">
                            <i class="bi bi-search"></i> Search
                        </button>
                    </div>
                </div>

                <!-- Medicine Cards Grid -->
                <div class="row" id="medicineGrid">
                    <!-- Medicine Card 1 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="antibiotic" data-species="human,dog,cat" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0">Amoxicillin</h5>
                                <small class="text-light">Antibiotic</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Amoxicillin</p>
                                <p class="card-text"><strong>Brand Names:</strong> Amoxil, Trimox</p>
                                <p class="card-text"><strong>Description:</strong> Broad-spectrum antibiotic used to
                                    treat bacterial infections.</p>
                                <p class="card-text"><strong>Species:</strong> Humans, Dogs, Cats</p>
                                <p class="card-text"><strong>Dosage:</strong> 250-500mg (varies by species and weight)
                                </p>
                                <p class="card-text"><strong>Side Effects:</strong> Nausea, diarrhea, allergic reactions
                                </p>
                                <p class="card-text text-success"><strong>Price: £25.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm"
                                        onclick="showMedicineDetails('amoxicillin')">View Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('amoxicillin', 'Amoxicillin', 25.99)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 2 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="anti-inflammatory"
                        data-species="human,horse,dog" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h5 class="card-title mb-0">Phenylbutazone</h5>
                                <small class="text-light">Anti-inflammatory</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Phenylbutazone</p>
                                <p class="card-text"><strong>Brand Names:</strong> Bute, Equipalazone</p>
                                <p class="card-text"><strong>Description:</strong> Non-steroidal anti-inflammatory drug
                                    (NSAID) commonly used in veterinary medicine.</p>
                                <p class="card-text"><strong>Species:</strong> Horses, Dogs, Limited human use</p>
                                <p class="card-text"><strong>Dosage:</strong> 2-4mg/kg body weight</p>
                                <p class="card-text"><strong>Side Effects:</strong> GI upset, bone marrow suppression
                                </p>
                                <p class="card-text text-success"><strong>Price: £45.50</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm"
                                        onclick="showMedicineDetails('phenylbutazone')">View Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('phenylbutazone', 'Phenylbutazone', 45.50)">Add to
                                        Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 3 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="anesthetic"
                        data-species="human,cat,dog,bird" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="card-title mb-0">Isoflurane</h5>
                                <small>Inhalation Anesthetic</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Isoflurane</p>
                                <p class="card-text"><strong>Brand Names:</strong> Forane, Terrell</p>
                                <p class="card-text"><strong>Description:</strong> Inhalation anesthetic used for
                                    general anesthesia across multiple species.</p>
                                <p class="card-text"><strong>Species:</strong> Humans, Dogs, Cats, Birds, Exotic animals
                                </p>
                                <p class="card-text"><strong>Dosage:</strong> 1-3% concentration (varies by species)</p>
                                <p class="card-text"><strong>Side Effects:</strong> Respiratory depression, hypotension
                                </p>
                                <p class="card-text text-success"><strong>Price: £89.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('isoflurane')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('isoflurane', 'Isoflurane', 89.99)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 4 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="analgesic" data-species="human,dog,cat" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-danger text-white">
                                <h5 class="card-title mb-0">Tramadol</h5>
                                <small class="text-light">Analgesic</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Tramadol HCl</p>
                                <p class="card-text"><strong>Brand Names:</strong> Ultram, Ryzolt</p>
                                <p class="card-text"><strong>Description:</strong> Centrally acting analgesic for
                                    moderate to severe pain management.</p>
                                <p class="card-text"><strong>Species:</strong> Humans, Dogs, Cats</p>
                                <p class="card-text"><strong>Dosage:</strong> 1-5mg/kg (varies by species)</p>
                                <p class="card-text"><strong>Side Effects:</strong> Sedation, nausea, constipation</p>
                                <p class="card-text text-success"><strong>Price: £35.75</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('tramadol')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('tramadol', 'Tramadol', 35.75)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 5 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="antiparasitic" data-species="dog,cat,horse" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <h5 class="card-title mb-0">Ivermectin</h5>
                                <small class="text-light">Antiparasitic</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Ivermectin</p>
                                <p class="card-text"><strong>Brand Names:</strong> Stromectol, Heartgard</p>
                                <p class="card-text"><strong>Description:</strong> Antiparasitic medication effective
                                    against various internal and external parasites.</p>
                                <p class="card-text"><strong>Species:</strong> Dogs, Cats, Horses, Livestock</p>
                                <p class="card-text"><strong>Dosage:</strong> 0.006-0.2mg/kg (species dependent)</p>
                                <p class="card-text"><strong>Side Effects:</strong> Neurological signs in sensitive
                                    breeds</p>
                                <p class="card-text text-success"><strong>Price: £18.25</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('ivermectin')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('ivermectin', 'Ivermectin', 18.25)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 6 -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="hormone" data-species="human,dog,cat" data-type="veterinary">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="card-title mb-0">Insulin</h5>
                                <small class="text-light">Hormone Therapy</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Human Insulin</p>
                                <p class="card-text"><strong>Brand Names:</strong> Humulin, Novolin</p>
                                <p class="card-text"><strong>Description:</strong> Hormone replacement therapy for
                                    diabetes mellitus management across species.</p>
                                <p class="card-text"><strong>Species:</strong> Humans, Dogs, Cats</p>
                                <p class="card-text"><strong>Dosage:</strong> 0.25-2.2 units/kg (highly variable)</p>
                                <p class="card-text"><strong>Side Effects:</strong> Hypoglycemia, injection site
                                    reactions</p>
                                <p class="card-text text-success"><strong>Price: £125.00</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('insulin')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('insulin', 'Insulin', 125.00)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isSignedIn = false;
        let currentUser = null;
        let cart = [];
        
        // Human medicines dataset - only shown when searched
        const humanMedicines = [
            {
                id: 'aspirin_human',
                name: 'Aspirin',
                category: 'analgesic',
                species: 'human',
                genericName: 'Acetylsalicylic Acid',
                brandNames: 'Bayer, Bufferin, Excedrin',
                description: 'Anti-inflammatory and pain reliever commonly used for headaches, fever, and cardiovascular protection.',
                dosage: '325-650mg every 4-6 hours',
                sideEffects: 'Stomach irritation, bleeding risk, tinnitus',
                price: 12.99,
                type: 'human'
            },
            {
                id: 'ibuprofen_human',
                name: 'Ibuprofen',
                category: 'anti-inflammatory',
                species: 'human',
                genericName: 'Ibuprofen',
                brandNames: 'Advil, Motrin, Nuprin',
                description: 'Nonsteroidal anti-inflammatory drug (NSAID) for pain, fever, and inflammation.',
                dosage: '200-400mg every 4-6 hours',
                sideEffects: 'GI upset, kidney problems, cardiovascular risk',
                price: 15.49,
                type: 'human'
            },
            {
                id: 'acetaminophen_human',
                name: 'Acetaminophen',
                category: 'analgesic',
                species: 'human',
                genericName: 'Acetaminophen',
                brandNames: 'Tylenol, Panadol, Feverall',
                description: 'Pain reliever and fever reducer, safer for stomach than NSAIDs.',
                dosage: '325-650mg every 4-6 hours',
                sideEffects: 'Liver damage with overdose, rare skin reactions',
                price: 9.99,
                type: 'human'
            },
            {
                id: 'metformin_human',
                name: 'Metformin',
                category: 'antidiabetic',
                species: 'human',
                genericName: 'Metformin HCl',
                brandNames: 'Glucophage, Fortamet, Riomet',
                description: 'First-line treatment for type 2 diabetes, improves insulin sensitivity.',
                dosage: '500-1000mg twice daily with meals',
                sideEffects: 'GI upset, lactic acidosis (rare), vitamin B12 deficiency',
                price: 22.75,
                type: 'human'
            },
            {
                id: 'lisinopril_human',
                name: 'Lisinopril',
                category: 'antihypertensive',
                species: 'human',
                genericName: 'Lisinopril',
                brandNames: 'Prinivil, Zestril',
                description: 'ACE inhibitor for high blood pressure and heart failure.',
                dosage: '5-40mg once daily',
                sideEffects: 'Dry cough, hyperkalemia, angioedema',
                price: 18.50,
                type: 'human'
            },
            {
                id: 'atorvastatin_human',
                name: 'Atorvastatin',
                category: 'statin',
                species: 'human',
                genericName: 'Atorvastatin Calcium',
                brandNames: 'Lipitor',
                description: 'HMG-CoA reductase inhibitor for cholesterol management.',
                dosage: '10-80mg once daily',
                sideEffects: 'Muscle pain, liver enzyme elevation, diabetes risk',
                price: 45.99,
                type: 'human'
            },
            {
                id: 'omeprazole_human',
                name: 'Omeprazole',
                category: 'proton-pump-inhibitor',
                species: 'human',
                genericName: 'Omeprazole',
                brandNames: 'Prilosec, Zegerid',
                description: 'Proton pump inhibitor for acid reflux and ulcers.',
                dosage: '20-40mg once daily before breakfast',
                sideEffects: 'Headache, diarrhea, bone fracture risk with long-term use',
                price: 28.99,
                type: 'human'
            },
            {
                id: 'sertraline_human',
                name: 'Sertraline',
                category: 'antidepressant',
                species: 'human',
                genericName: 'Sertraline HCl',
                brandNames: 'Zoloft',
                description: 'Selective serotonin reuptake inhibitor (SSRI) for depression and anxiety.',
                dosage: '25-200mg once daily',
                sideEffects: 'Nausea, sexual dysfunction, withdrawal syndrome',
                price: 32.25,
                type: 'human'
            },
            {
                id: 'levothyroxine_human',
                name: 'Levothyroxine',
                category: 'hormone',
                species: 'human',
                genericName: 'Levothyroxine Sodium',
                brandNames: 'Synthroid, Levoxyl, Tirosint',
                description: 'Thyroid hormone replacement for hypothyroidism.',
                dosage: '25-200mcg once daily on empty stomach',
                sideEffects: 'Heart palpitations, insomnia, weight loss',
                price: 35.50,
                type: 'human'
            },
            {
                id: 'albuterol_human',
                name: 'Albuterol',
                category: 'bronchodilator',
                species: 'human',
                genericName: 'Albuterol Sulfate',
                brandNames: 'ProAir, Ventolin, Proventil',
                description: 'Short-acting beta2-agonist for asthma and COPD.',
                dosage: '2 puffs every 4-6 hours as needed',
                sideEffects: 'Tremor, tachycardia, nervousness',
                price: 55.99,
                type: 'human'
            },
            {
                id: 'warfarin_human',
                name: 'Warfarin',
                category: 'anticoagulant',
                species: 'human',
                genericName: 'Warfarin Sodium',
                brandNames: 'Coumadin, Jantoven',
                description: 'Anticoagulant for preventing blood clots and stroke.',
                dosage: '2-10mg daily (highly individualized)',
                sideEffects: 'Bleeding, skin necrosis, purple toe syndrome',
                price: 24.75,
                type: 'human'
            },
            {
                id: 'hydrochlorothiazide_human',
                name: 'Hydrochlorothiazide',
                category: 'diuretic',
                species: 'human',
                genericName: 'Hydrochlorothiazide',
                brandNames: 'Microzide, HCTZ',
                description: 'Thiazide diuretic for high blood pressure and fluid retention.',
                dosage: '12.5-50mg once daily',
                sideEffects: 'Electrolyte imbalance, dehydration, hyperuricemia',
                price: 16.25,
                type: 'human'
            },
            {
                id: 'prednisone_human',
                name: 'Prednisone',
                category: 'corticosteroid',
                species: 'human',
                genericName: 'Prednisone',
                brandNames: 'Deltasone, Rayos, Prednisone Intensol',
                description: 'Corticosteroid for inflammation, autoimmune conditions, and allergies.',
                dosage: '5-60mg daily (varies by condition)',
                sideEffects: 'Weight gain, mood changes, osteoporosis, immunosuppression',
                price: 19.99,
                type: 'human'
            },
            {
                id: 'gabapentin_human',
                name: 'Gabapentin',
                category: 'anticonvulsant',
                species: 'human',
                genericName: 'Gabapentin',
                brandNames: 'Neurontin, Gralise, Horizant',
                description: 'Anticonvulsant used for neuropathic pain and seizures.',
                dosage: '300-1800mg daily in divided doses',
                sideEffects: 'Dizziness, fatigue, peripheral edema',
                price: 27.50,
                type: 'human'
            },
            {
                id: 'amlodipine_human',
                name: 'Amlodipine',
                category: 'calcium-channel-blocker',
                species: 'human',
                genericName: 'Amlodipine Besylate',
                brandNames: 'Norvasc',
                description: 'Calcium channel blocker for high blood pressure and angina.',
                dosage: '2.5-10mg once daily',
                sideEffects: 'Peripheral edema, dizziness, flushing',
                price: 21.99,
                type: 'human'
            }
        ];

        function submitSignin() {
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;

            if (!email || !password) {
                alert('Please fill in all fields!');
                return;
            }

            // Simulate authentication (in real app, this would be an API call)
            if (email === 'test@example.com' && password === 'password') {
                isSignedIn = true;
                currentUser = { 
                    email: email, 
                    name: 'John',  // Only first name
                    fullName: 'John Doe'  // Keep full name for other purposes
                };

                // Update UI to show user is signed in
                updateUIForSignedInUser();

                alert('Welcome back! You are now signed in.');

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('signinModal'));
                modal.hide();

                // Reset form
                document.getElementById('signinForm').reset();
            } else {
                alert('Invalid email or password. Try: test@example.com / password');
            }
        }

        function updateUIForSignedInUser() {
            // Show user greeting
            document.getElementById('userGreeting').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;
            
            // Hide sign in/sign up buttons
            document.getElementById('authButtons').style.display = 'none';
            
            // Show sign out button
            document.getElementById('signoutBtn').style.display = 'block';
        }

        function signOut() {
            isSignedIn = false;
            currentUser = null;
            cart = []; // Clear cart on sign out
            
            // Update UI
            document.getElementById('userGreeting').style.display = 'none';
            document.getElementById('authButtons').style.display = 'block';
            document.getElementById('signoutBtn').style.display = 'none';
            
            // Update cart count
            updateCartCount();
            
            alert('You have been signed out successfully.');
        }

        function addToCart(medicineId, medicineName, price) {
            if (!isSignedIn) {
                alert('Please sign in first to add items to cart.');
                const modal = new bootstrap.Modal(document.getElementById('signinModal'));
                modal.show();
                return;
            }

            // Check if item already exists in cart
            const existingItem = cart.find(item => item.id === medicineId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: medicineId,
                    name: medicineName,
                    price: price,
                    quantity: 1
                });
            }

            updateCartCount();
            alert(`${medicineName} added to cart!`);
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        function showCart() {
            if (cart.length === 0) {
                document.getElementById('cartItems').innerHTML = '<p class="text-muted">Your cart is empty.</p>';
                document.getElementById('cartTotal').textContent = '0.00';
                document.getElementById('checkoutBtn').disabled = true;
            } else {
                let cartHTML = '';
                let total = 0;

                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    cartHTML += `
                        <div class="d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
                            <div>
                                <h6>${item.name}</h6>
                                <p class="text-muted mb-0">£${item.price.toFixed(2)} each</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <button class="btn btn-outline-secondary btn-sm me-2" onclick="updateQuantity(${index}, -1)">-</button>
                                <span class="mx-2">${item.quantity}</span>
                                <button class="btn btn-outline-secondary btn-sm me-2" onclick="updateQuantity(${index}, 1)">+</button>
                                <span class="fw-bold">£${itemTotal.toFixed(2)}</span>
                                <button class="btn btn-danger btn-sm ms-2" onclick="removeFromCart(${index})">Remove</button>
                            </div>
                        </div>
                    `;
                });

                document.getElementById('cartItems').innerHTML = cartHTML;
                document.getElementById('cartTotal').textContent = total.toFixed(2);
                document.getElementById('checkoutBtn').disabled = false;
            }

            const modal = new bootstrap.Modal(document.getElementById('cartModal'));
            modal.show();
        }

        function updateQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            updateCartCount();
            showCart();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            showCart();
        }

        function proceedToCheckout() {
            if (!isSignedIn) {
                alert('Please sign in first.');
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            let orderHTML = '';
            cart.forEach(item => {
                orderHTML += `
                    <div class="d-flex justify-content-between mb-2">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            });
            orderHTML += `<hr><div class="d-flex justify-content-between fw-bold"><span>Total:</span><span>$${total.toFixed(2)}</span></div>`;

            document.getElementById('orderSummary').innerHTML = orderHTML;
            document.getElementById('totalAmount').textContent = total.toFixed(2);

            const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
            cartModal.hide();

            const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            paymentModal.show();
        }

        function processPayment() {
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const cardName = document.getElementById('cardName').value;
            const billingAddress = document.getElementById('billingAddress').value;

            if (!cardNumber || !expiryDate || !cvv || !cardName || !billingAddress) {
                alert('Please fill in all payment fields!');
                return;
            }

            const totalAmount = document.getElementById('totalAmount').textContent;

            const payBtn = document.querySelector('[onclick="processPayment()"]');
            payBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
            payBtn.disabled = true;

            setTimeout(() => {
                alert(`Payment successful! Total: $${totalAmount}\nOrder confirmation will be sent to ${currentUser.email}`);

                cart = [];
                updateCartCount();

                payBtn.innerHTML = '<i class="bi bi-credit-card"></i> Pay Now';
                payBtn.disabled = false;

                const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
                modal.hide();

                document.getElementById('paymentForm').reset();
            }, 2000);
        }

        function submitSignup() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!firstName || !lastName || !email || !password || !confirmPassword) {
                alert('Please fill in all fields!');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            // Simulate user registration and automatic sign-in
            isSignedIn = true;
            currentUser = { 
                email: email, 
                name: firstName,  // Only first name for display
                fullName: `${firstName} ${lastName}`  // Keep full name for other purposes
            };

            // Update UI to show user is signed in
            updateUIForSignedInUser();

            alert(`Welcome ${firstName}! Your account has been created and you are now signed in.`);

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
            modal.hide();

            // Reset the form
            document.getElementById('signupForm').reset();
        }



        function submitContact() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;

            if (!name || !email || !subject || !message) {
                alert('Please fill in all fields!');
                return;
            }

            // Here you would typically send the contact form data to your Django backend
            alert('Thank you for your message! We will get back to you soon.');

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
            modal.hide();

            // Reset the form
            document.getElementById('contactForm').reset();
        }

        async function searchMedicines() {
            const searchTerm = document.getElementById('medicineSearch').value.trim();
            const medicineGrid = document.querySelector('.row');
            
            if (searchTerm.length === 0) {
                // If search is empty, show only veterinary medicines (original cards)
                showOnlyVeterinaryMedicines();
                return;
            }

            try {
                // Fetch human medicines from Django API
                const response = await fetch(`/api/search/?q=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                // Remove any existing human medicine cards
                const existingHumanCards = document.querySelectorAll('.medicine-card[data-type="human"]');
                existingHumanCards.forEach(card => card.remove());

                // Hide all veterinary cards since we're showing search results
                const veterinaryCards = document.querySelectorAll('.medicine-card[data-type="veterinary"]');
                veterinaryCards.forEach(card => {
                    card.style.display = 'none';
                });

                // Add human medicine cards to the grid
                if (data.medicines && data.medicines.length > 0) {
                    data.medicines.forEach(medicine => {
                        const humanCard = createHumanMedicineCard(medicine);
                        medicineGrid.appendChild(humanCard);
                    });
                } else {
                    // Show "no results" message
                    const noResultsCard = createNoResultsCard(searchTerm);
                    medicineGrid.appendChild(noResultsCard);
                }
            } catch (error) {
                console.error('Error searching medicines:', error);
                // Fallback to showing veterinary medicines
                showOnlyVeterinaryMedicines();
            }
        }

        function showOnlyVeterinaryMedicines() {
            // Show all veterinary medicine cards
            const veterinaryCards = document.querySelectorAll('.medicine-card[data-type="veterinary"]');
            veterinaryCards.forEach(card => {
                card.style.display = 'block';
            });

            // Remove any human medicine cards
            const humanCards = document.querySelectorAll('.medicine-card[data-type="human"]');
            humanCards.forEach(card => card.remove());
        }

        function createHumanMedicineCard(medicine) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'col-md-4 mb-4 medicine-card';
            cardDiv.setAttribute('data-category', medicine.category);
            cardDiv.setAttribute('data-species', medicine.species_applicable);
            cardDiv.setAttribute('data-type', 'human');

            // Generate a random price for display purposes
            const price = (Math.random() * 50 + 10).toFixed(2);

            cardDiv.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title text-primary">${medicine.name}</h5>
                        <p class="card-text text-muted small mb-2">
                            <i class="fas fa-tag"></i> ${medicine.category} | 
                            <i class="fas fa-user"></i> ${medicine.species_applicable}
                        </p>
                        <p class="card-text"><strong>Dosage:</strong> ${medicine.dosage}</p>
                        <p class="card-text">${medicine.notes}</p>
                        <p class="text-success fw-bold">£${price}</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="showHumanMedicineDetails('${medicine.id}')">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="btn btn-success btn-sm" onclick="addToCart('${medicine.id}', '${medicine.name}', ${price}, 'human')">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                </div>
            `;

            return cardDiv;
        }

        function showMedicineDetails(medicineId) {
            // Here you would fetch the medicine details from your backend using the medicineId
            // For demonstration, we will use static content
            let medicineDetails = {
                'amoxicillin': {
                    'Generic Name': 'Amoxicillin',
                    'Brand Names': 'Amoxil, Trimox',
                    'Description': 'Broad-spectrum antibiotic used to treat bacterial infections.',
                    'Species': 'Humans, Dogs, Cats',
                    'Dosage': '250-500mg (varies by species and weight)',
                    'Side Effects': 'Nausea, diarrhea, allergic reactions'
                },
                'phenylbutazone': {
                    'Generic Name': 'Phenylbutazone',
                    'Brand Names': 'Bute, Equipalazone',
                    'Description': 'Non-steroidal anti-inflammatory drug (NSAID) commonly used in veterinary medicine.',
                    'Species': 'Horses, Dogs, Limited human use',
                    'Dosage': '2-4mg/kg body weight',
                    'Side Effects': 'GI upset, bone marrow suppression'
                },
                'isoflurane': {
                    'Generic Name': 'Isoflurane',
                    'Brand Names': 'Forane, Terrell',
                    'Description': 'Inhalation anesthetic used for general anesthesia across multiple species.',
                    'Species': 'Humans, Dogs, Cats, Birds, Exotic animals',
                    'Dosage': '1-3% concentration (varies by species)',
                    'Side Effects': 'Respiratory depression, hypotension'
                },
                'tramadol': {
                    'Generic Name': 'Tramadol HCl',
                    'Brand Names': 'Ultram, Ryzolt',
                    'Description': 'Centrally acting analgesic for moderate to severe pain management.',
                    'Species': 'Humans, Dogs, Cats',
                    'Dosage': '1-5mg/kg (varies by species)',
                    'Side Effects': 'Sedation, nausea, constipation'
                },
                'ivermectin': {
                    'Generic Name': 'Ivermectin',
                    'Brand Names': 'Stromectol, Heartgard',
                    'Description': 'Antiparasitic medication effective against various internal and external parasites.',
                    'Species': 'Dogs, Cats, Horses, Livestock',
                    'Dosage': '0.006-0.2mg/kg (species dependent)',
                    'Side Effects': 'Neurological signs in sensitive breeds'
                },
                'insulin': {
                    'Generic Name': 'Human Insulin',
                    'Brand Names': 'Humulin, Novolin',
                    'Description': 'Hormone replacement therapy for diabetes mellitus management across species.',
                    'Species': 'Humans, Dogs, Cats',
                    'Dosage': '0.25-2.2 units/kg (highly variable)',
                    'Side Effects': 'Hypoglycemia, injection site reactions'
                }
            };

            let details = medicineDetails[medicineId];

            if (details) {
                let content = '<ul class="list-group">';
                for (let key in details) {
                    content += `<li class="list-group-item"><strong>${key}:</strong> ${details[key]}</li>`;
                }
                content += '</ul>';

                document.getElementById('medicineDetailsContent').innerHTML = content;

                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('medicineDetailsModal'));
                modal.show();
            } else {
                alert('Medicine details not found!');
            }
        }

        function updateTotal() {
            const quantity = document.getElementById('quantity').value;
            const pricePerUnit = 10; // Assume each medicine unit costs $10 for demonstration
            const totalAmount = (quantity * pricePerUnit).toFixed(2);

            document.getElementById('totalAmount').innerText = totalAmount;
        }

        function processPayment() {
            // Here you would typically process the payment with the provided card details
            alert('Payment processing functionality would be implemented here!');

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
            modal.hide();
        }

        function addToCart(medicineId) {
            // Here you would add the selected medicine to the cart
            // For demonstration, we will just show an alert
            alert('Medicine added to cart: ' + medicineId);

            // Update cart UI
            updateCartUI();
        }

        function updateCartUI() {
            // Here you would update the cart UI with the current items in the cart
            // For demonstration, we will just show static content
            const cartItems = `
                <div class="cart-item d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6 class="mb-1">Amoxicillin</h6>
                        <small>Quantity: 1</small>
                    </div>
                    <div>
                        <strong>$10.00</strong>
                    </div>
                </div>
            `;

            document.getElementById('cartItems').innerHTML = cartItems;
            document.getElementById('cartTotal').innerText = '10.00';

            // Enable checkout button if there are items in the cart
            document.getElementById('checkoutBtn').disabled = false;
        }

        function proceedToCheckout() {
            // Here you would proceed to the checkout process
            // For demonstration, we will just show the payment modal
            const modal = new bootstrap.Modal(document.getElementById('paymentModal'));
            modal.show();
        }

        // Enable search on Enter key press
        document.getElementById('medicineSearch').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                searchMedicines();
            }
        });

        // Load medicines into the select dropdown when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadMedicinesIntoSelect();
        });

        async function loadMedicinesIntoSelect() {
            try {
                const response = await fetch('/api/medicines/');
                const data = await response.json();
                
                const selectElement = document.getElementById('medicineSelect');
                selectElement.innerHTML = '<option value="">Choose a medicine...</option>';
                
                if (data.medicines && data.medicines.length > 0) {
                    data.medicines.forEach(medicine => {
                        const option = document.createElement('option');
                        option.value = medicine.id;
                        option.textContent = `${medicine.name} (${medicine.category}) - ${medicine.species_applicable}`;
                        option.setAttribute('data-category', medicine.category);
                        option.setAttribute('data-species', medicine.species_applicable);
                        selectElement.appendChild(option);
                    });
                } else {
                    selectElement.innerHTML = '<option value="">No medicines available</option>';
                }
            } catch (error) {
                console.error('Error loading medicines:', error);
                document.getElementById('medicineSelect').innerHTML = '<option value="">Error loading medicines</option>';
            }
        }

        async function selectMedicine() {
            const selectElement = document.getElementById('medicineSelect');
            const selectedMedicineId = selectElement.value;
            
            if (!selectedMedicineId) {
                // If no medicine is selected, hide add to cart section and show all veterinary medicines
                document.getElementById('addToCartSection').style.display = 'none';
                showOnlyVeterinaryMedicines();
                return;
            }

            try {
                // Fetch specific medicine details
                const response = await fetch(`/api/medicines/${selectedMedicineId}/`);
                const medicine = await response.json();
                
                // Update add to cart section
                updateAddToCartSection(medicine);
                
                // Clear the current grid
                const medicineGrid = document.querySelector('.row');
                
                // Hide veterinary cards
                const veterinaryCards = document.querySelectorAll('.medicine-card[data-type="veterinary"]');
                veterinaryCards.forEach(card => {
                    card.style.display = 'none';
                });

                // Remove any existing human medicine cards
                const existingHumanCards = document.querySelectorAll('.medicine-card[data-type="human"]');
                existingHumanCards.forEach(card => card.remove());

                // Create and display the selected medicine card
                const selectedCard = createHumanMedicineCard(medicine);
                selectedCard.classList.add('border-primary');
                selectedCard.querySelector('.card').classList.add('border-primary', 'border-3');
                medicineGrid.appendChild(selectedCard);

                // Scroll to the medicine card
                selectedCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            } catch (error) {
                console.error('Error fetching medicine details:', error);
                alert('Error loading medicine details. Please try again.');
            }
        }

        function filterByCategory() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const selectElement = document.getElementById('medicineSelect');
            const options = selectElement.querySelectorAll('option[data-category]');
            
            // Reset the medicine selection
            selectElement.value = '';
            
            // Show/hide options based on category filter
            options.forEach(option => {
                if (!categoryFilter || option.getAttribute('data-category') === categoryFilter) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });

            // If a category is selected, show medicines from that category
            if (categoryFilter) {
                searchMedicinesByCategory(categoryFilter);
            } else {
                showOnlyVeterinaryMedicines();
            }
        }

        function filterBySpecies() {
            const speciesFilter = document.getElementById('speciesFilter').value;
            const selectElement = document.getElementById('medicineSelect');
            const options = selectElement.querySelectorAll('option[data-species]');
            
            // Reset the medicine selection
            selectElement.value = '';
            
            // Show/hide options based on species filter
            options.forEach(option => {
                if (!speciesFilter || option.getAttribute('data-species').includes(speciesFilter)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });

            // If a species is selected, show medicines for that species
            if (speciesFilter) {
                searchMedicinesBySpecies(speciesFilter);
            } else {
                showOnlyVeterinaryMedicines();
            }
        }

        async function searchMedicinesByCategory(category) {
            try {
                const response = await fetch(`/api/search/?category=${encodeURIComponent(category)}`);
                const data = await response.json();
                displaySearchResults(data.medicines);
            } catch (error) {
                console.error('Error searching by category:', error);
                showOnlyVeterinaryMedicines();
            }
        }

        async function searchMedicinesBySpecies(species) {
            try {
                const response = await fetch(`/api/search/?species=${encodeURIComponent(species)}`);
                const data = await response.json();
                displaySearchResults(data.medicines);
            } catch (error) {
                console.error('Error searching by species:', error);
                showOnlyVeterinaryMedicines();
            }
        }

        function displaySearchResults(medicines) {
            const medicineGrid = document.querySelector('.row');
            
            // Hide veterinary cards
            const veterinaryCards = document.querySelectorAll('.medicine-card[data-type="veterinary"]');
            veterinaryCards.forEach(card => {
                card.style.display = 'none';
            });

            // Remove any existing human medicine cards
            const existingHumanCards = document.querySelectorAll('.medicine-card[data-type="human"]');
            existingHumanCards.forEach(card => card.remove());

            // Add search results
            if (medicines && medicines.length > 0) {
                medicines.forEach(medicine => {
                    const card = createHumanMedicineCard(medicine);
                    medicineGrid.appendChild(card);
                });
            } else {
                const noResultsCard = createNoResultsCard('filter criteria');
                medicineGrid.appendChild(noResultsCard);
            }
        }

        // Load all medicines function
        async function loadAllMedicines() {
            try {
                const response = await fetch('/api/medicines/');
                const data = await response.json();
                
                if (data.medicines && data.medicines.length > 0) {
                    displaySearchResults(data.medicines);
                } else {
                    showOnlyVeterinaryMedicines();
                }
            } catch (error) {
                console.error('Error loading all medicines:', error);
                showOnlyVeterinaryMedicines();
            }
        }

        // Clear all filters function
        function clearAllFilters() {
            document.getElementById('medicineSelect').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('speciesFilter').value = '';
            document.getElementById('medicineSearch').value = '';
            document.getElementById('addToCartSection').style.display = 'none';
            showOnlyVeterinaryMedicines();
        }

        // Comprehensive Formula Database
        function getComprehensiveFormulaData(medicineName) {
            const formulaDatabase = {
                'Ibuprofen': {
                    molecularFormula: 'C₁₃H₁₈O₂',
                    molecularWeight: '206.28 g/mol',
                    chemicalName: '2-(4-isobutylphenyl)propionic acid',
                    mechanismOfAction: 'Non-selective COX-1 and COX-2 inhibitor, reducing prostaglandin synthesis',
                    therapeuticClass: 'Nonsteroidal Anti-inflammatory Drug (NSAID)',
                    routeOfAdmin: 'Oral, Topical',
                    absorption: 'Rapidly absorbed from GI tract, peak levels in 1-4 hours',
                    distribution: 'Highly protein bound (99%), limited distribution to CNS',
                    metabolism: 'Hepatic metabolism via CYP2C9, glucuronidation',
                    elimination: 'Renal elimination, half-life 2-4 hours',
                    contraindications: 'Peptic ulcer disease, severe renal/hepatic impairment, aspirin allergy',
                    sideEffects: 'GI upset, increased bleeding risk, renal dysfunction, hypertension'
                },
                'Amoxicillin': {
                    molecularFormula: 'C₁₆H₁₉N₃O₅S',
                    molecularWeight: '365.40 g/mol',
                    chemicalName: '(2S,5R,6R)-6-[(2R)-2-amino-2-(4-hydroxyphenyl)acetamido]-3,3-dimethyl-7-oxo-4-thia-1-azabicyclo[3.2.0]heptane-2-carboxylic acid',
                    mechanismOfAction: 'Inhibits bacterial cell wall synthesis by binding to penicillin-binding proteins',
                    therapeuticClass: 'Beta-lactam Antibiotic (Penicillin)',
                    routeOfAdmin: 'Oral, Intravenous',
                    absorption: 'Well absorbed orally (75-90%), not affected by food',
                    distribution: 'Widely distributed, crosses placenta, minimal CNS penetration',
                    metabolism: 'Minimal hepatic metabolism (10-25%)',
                    elimination: 'Primarily renal excretion, half-life 1-1.3 hours',
                    contraindications: 'Penicillin allergy, severe renal impairment',
                    sideEffects: 'Allergic reactions, GI upset, superinfection, skin rash'
                },
                'Carprofen': {
                    molecularFormula: 'C₁₅H₁₂ClNO₂',
                    molecularWeight: '273.71 g/mol',
                    chemicalName: '6-chloro-α-methyl-9H-carbazole-2-acetic acid',
                    mechanismOfAction: 'Preferential COX-2 inhibitor with some COX-1 activity',
                    therapeuticClass: 'Veterinary NSAID',
                    routeOfAdmin: 'Oral, Injectable',
                    absorption: 'Rapidly absorbed, peak levels in 1-3 hours in dogs',
                    distribution: 'Highly protein bound (>95%), good tissue penetration',
                    metabolism: 'Hepatic metabolism, glucuronidation in dogs',
                    elimination: 'Biliary and renal excretion, half-life 8 hours in dogs',
                    contraindications: 'GI ulceration, renal/hepatic disease, concurrent steroid use',
                    sideEffects: 'GI upset, hepatotoxicity, renal dysfunction, behavioral changes'
                },
                'Tramadol': {
                    molecularFormula: 'C₁₆H₂₅NO₂',
                    molecularWeight: '263.38 g/mol',
                    chemicalName: '(±)-trans-2-[(dimethylamino)methyl]-1-(3-methoxyphenyl)cyclohexanol',
                    mechanismOfAction: 'Weak μ-opioid receptor agonist, inhibits serotonin and norepinephrine reuptake',
                    therapeuticClass: 'Centrally Acting Analgesic',
                    routeOfAdmin: 'Oral, Injectable',
                    absorption: 'Well absorbed orally (75%), peak levels in 2 hours',
                    distribution: 'Crosses blood-brain barrier, moderate protein binding (20%)',
                    metabolism: 'Hepatic metabolism via CYP2D6 to active metabolite M1',
                    elimination: 'Renal excretion, half-life 5-7 hours',
                    contraindications: 'Seizure disorders, MAO inhibitor use, respiratory depression',
                    sideEffects: 'Seizures, serotonin syndrome, respiratory depression, dependence potential'
                },
                'Ivermectin': {
                    molecularFormula: 'C₄₈H₇₄O₁₄',
                    molecularWeight: '875.09 g/mol',
                    chemicalName: '22,23-dihydroavermectin B1a + 22,23-dihydroavermectin B1b',
                    mechanismOfAction: 'Binds to glutamate-gated chloride channels, causing paralysis in parasites',
                    therapeuticClass: 'Macrocyclic Lactone Antiparasitic',
                    routeOfAdmin: 'Oral, Topical, Injectable',
                    absorption: 'Well absorbed orally in most species, peak levels in 4-5 hours',
                    distribution: 'Highly lipophilic, extensive tissue distribution, crosses blood-brain barrier minimally',
                    metabolism: 'Hepatic metabolism via CYP3A4',
                    elimination: 'Biliary excretion primarily, half-life 12-36 hours (species dependent)',
                    contraindications: 'MDR1 gene mutations (collies), severe hepatic impairment',
                    sideEffects: 'Neurological signs in sensitive breeds, hypersensitivity reactions'
                },
                'Prednisolone': {
                    molecularFormula: 'C₂₁H₂₈O₅',
                    molecularWeight: '360.44 g/mol',
                    chemicalName: '11β,17α,21-trihydroxypregna-1,4-diene-3,20-dione',
                    mechanismOfAction: 'Binds to glucocorticoid receptors, modulates gene transcription and protein synthesis',
                    therapeuticClass: 'Synthetic Glucocorticoid',
                    routeOfAdmin: 'Oral, Injectable, Topical',
                    absorption: 'Well absorbed orally, peak levels in 1-2 hours',
                    distribution: 'Widely distributed, crosses placenta and blood-brain barrier',
                    metabolism: 'Hepatic metabolism, converted to inactive metabolites',
                    elimination: 'Renal excretion, biological half-life 12-36 hours',
                    contraindications: 'Viral infections, fungal infections, vaccination periods',
                    sideEffects: 'Immunosuppression, PU/PD, weight gain, GI ulceration, behavioral changes'
                },
                'Gabapentin': {
                    molecularFormula: 'C₉H₁₇NO₂',
                    molecularWeight: '171.24 g/mol',
                    chemicalName: '1-(aminomethyl)cyclohexaneacetic acid',
                    mechanismOfAction: 'Binds to α2δ subunit of voltage-gated calcium channels, modulates neurotransmitter release',
                    therapeuticClass: 'Anticonvulsant/Neuropathic Pain Agent',
                    routeOfAdmin: 'Oral',
                    absorption: 'Variable absorption (27-60%), not affected by food',
                    distribution: 'Minimal protein binding (<3%), crosses blood-brain barrier',
                    metabolism: 'Not metabolized, excreted unchanged',
                    elimination: 'Renal excretion, half-life 5-7 hours in humans, 3-4 hours in dogs',
                    contraindications: 'Severe renal impairment, known hypersensitivity',
                    sideEffects: 'Sedation, ataxia, behavioral changes, potential withdrawal symptoms'
                }
            };
            
            // Return data for the medicine, or default values if not found
            return formulaDatabase[medicineName] || {
                molecularFormula: 'Data not available',
                molecularWeight: 'Data not available',
                chemicalName: 'Chemical name not available for this medicine',
                mechanismOfAction: 'Mechanism of action information not available',
                therapeuticClass: 'Classification information not available',
                routeOfAdmin: 'Administration route not specified',
                absorption: 'Absorption data not available',
                distribution: 'Distribution data not available',
                metabolism: 'Metabolism data not available',
                elimination: 'Elimination data not available',
                contraindications: 'Contraindication information not available',
                sideEffects: 'Side effect information not available'
            };
        }

        // Update add to cart section with selected medicine
        function updateAddToCartSection(medicine) {
            document.getElementById('selectedMedicineName').textContent = medicine.name;
            document.getElementById('selectedMedicineCategory').textContent = medicine.category;
            document.getElementById('selectedMedicineSpecies').textContent = medicine.species_applicable;
            document.getElementById('selectedMedicineDosage').textContent = medicine.dosage;
            
            // Generate a random price for demonstration (in a real app, this would come from the database)
            const price = (Math.random() * 100 + 10).toFixed(2);
            document.getElementById('selectedMedicinePrice').textContent = price;
            
            // Get comprehensive formula data
            const formulaData = getComprehensiveFormulaData(medicine.name);
            
            // Update formula information
            document.getElementById('molecularFormula').textContent = formulaData.molecularFormula;
            document.getElementById('molecularWeight').textContent = formulaData.molecularWeight;
            document.getElementById('chemicalName').textContent = formulaData.chemicalName;
            document.getElementById('mechanismOfAction').textContent = formulaData.mechanismOfAction;
            document.getElementById('therapeuticClass').textContent = formulaData.therapeuticClass;
            document.getElementById('routeOfAdmin').textContent = formulaData.routeOfAdmin;
            document.getElementById('absorption').textContent = formulaData.absorption;
            document.getElementById('distribution').textContent = formulaData.distribution;
            document.getElementById('metabolism').textContent = formulaData.metabolism;
            document.getElementById('elimination').textContent = formulaData.elimination;
            document.getElementById('contraindications').textContent = formulaData.contraindications;
            document.getElementById('sideEffects').textContent = formulaData.sideEffects;
            
            // Show the add to cart section
            document.getElementById('addToCartSection').style.display = 'block';
            
            // Store medicine data for cart addition
            window.selectedMedicineData = {
                id: medicine.id,
                name: medicine.name,
                category: medicine.category,
                dosage: medicine.dosage,
                species_applicable: medicine.species_applicable,
                price: parseFloat(price),
                notes: medicine.notes
            };
        }

        // Add selected medicine to cart
        function addSelectedMedicineToCart() {
            if (!window.selectedMedicineData) {
                alert('Please select a medicine first.');
                return;
            }

            const quantity = parseInt(document.getElementById('quantitySelect').value);
            const medicine = window.selectedMedicineData;
            
            // Check if medicine is already in cart
            const existingItem = cart.find(item => item.id === medicine.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: medicine.id,
                    name: medicine.name,
                    category: medicine.category,
                    dosage: medicine.dosage,
                    species: medicine.species_applicable,
                    price: medicine.price,
                    quantity: quantity,
                    notes: medicine.notes
                });
            }
            
            updateCartUI();
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.className = 'alert alert-success alert-dismissible fade show mt-2';
            successMessage.innerHTML = `
                <strong>Success!</strong> ${medicine.name} (${quantity}x) has been added to your cart.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const addToCartSection = document.getElementById('addToCartSection');
            addToCartSection.appendChild(successMessage);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.remove();
                }
            }, 3000);
        }

        // Patient Information Functions
        function savePatientInfo() {
            const age = document.getElementById('patientAge').value;
            const weight = document.getElementById('patientWeight').value;
            const weightUnit = document.getElementById('weightUnit').value;
            const height = document.getElementById('patientHeight').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const allergies = document.getElementById('patientAllergies').value;

            // Save to localStorage
            const patientData = {
                age: age,
                weight: weight,
                weightUnit: weightUnit,
                height: height,
                heightUnit: heightUnit,
                allergies: allergies,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('patientInfo', JSON.stringify(patientData));

            // Show success message
            showPatientInfoSaved();

            // Check for safety alerts
            checkSafetyAlerts(patientData);

            // Calculate BMI if height and weight are provided
            if (height && weight) {
                calculateBMI();
            }
        }

        function clearPatientInfo() {
            document.getElementById('patientAge').value = '';
            document.getElementById('patientWeight').value = '';
            document.getElementById('patientHeight').value = '';
            document.getElementById('patientAllergies').value = '';
            document.getElementById('bmiSection').style.display = 'none';
            document.getElementById('safetyAlerts').style.display = 'none';
            localStorage.removeItem('patientInfo');
        }

        function loadPatientInfo() {
            const savedData = localStorage.getItem('patientInfo');
            if (savedData) {
                const patientData = JSON.parse(savedData);
                document.getElementById('patientAge').value = patientData.age || '';
                document.getElementById('patientWeight').value = patientData.weight || '';
                document.getElementById('weightUnit').value = patientData.weightUnit || 'kg';
                document.getElementById('patientHeight').value = patientData.height || '';
                document.getElementById('heightUnit').value = patientData.heightUnit || 'cm';
                document.getElementById('patientAllergies').value = patientData.allergies || '';
            }
        }

        function calculateBMI() {
            const weight = parseFloat(document.getElementById('patientWeight').value);
            const height = parseFloat(document.getElementById('patientHeight').value);
            const weightUnit = document.getElementById('weightUnit').value;
            const heightUnit = document.getElementById('heightUnit').value;

            if (!weight || !height) {
                alert('Please enter both weight and height to calculate BMI.');
                return;
            }

            // Convert to metric units
            let weightKg = weight;
            let heightM = height;

            if (weightUnit === 'lbs') {
                weightKg = weight * 0.453592;
            }

            if (heightUnit === 'ft') {
                heightM = height * 0.3048;
            } else {
                heightM = height / 100; // cm to meters
            }

            // Calculate BMI
            const bmi = weightKg / (heightM * heightM);
            const bmiRounded = Math.round(bmi * 10) / 10;

            // Determine BMI category
            let category, note, alertClass;
            if (bmi < 18.5) {
                category = 'Underweight';
                note = 'May need higher caloric intake and careful medication dosing.';
                alertClass = 'alert-warning';
            } else if (bmi < 25) {
                category = 'Normal weight';
                note = 'Healthy weight range for most medications.';
                alertClass = 'alert-success';
            } else if (bmi < 30) {
                category = 'Overweight';
                note = 'May require dose adjustments for some medications.';
                alertClass = 'alert-warning';
            } else {
                category = 'Obese';
                note = 'Requires careful dose calculations and monitoring for many medications.';
                alertClass = 'alert-danger';
            }

            // Display BMI results
            document.getElementById('bmiValue').textContent = bmiRounded;
            document.getElementById('bmiCategory').textContent = category;
            document.getElementById('bmiNote').textContent = note;
            document.getElementById('bmiSection').style.display = 'block';
            document.getElementById('bmiSection').querySelector('.alert').className = `alert ${alertClass}`;
        }

        function checkSafetyAlerts(patientData) {
            const alerts = [];
            const age = parseInt(patientData.age);
            const allergies = patientData.allergies.toLowerCase();

            // Age-based alerts
            if (age < 18) {
                alerts.push('Pediatric patient: Many medications require special pediatric dosing.');
            }
            if (age >= 65) {
                alerts.push('Geriatric patient: Increased risk of drug interactions and side effects.');
            }

            // Allergy-based alerts
            if (allergies.includes('penicillin')) {
                alerts.push('Penicillin allergy: Avoid all penicillin-based antibiotics.');
            }
            if (allergies.includes('aspirin')) {
                alerts.push('Aspirin allergy: Avoid NSAIDs and salicylates.');
            }
            if (allergies.includes('sulfa')) {
                alerts.push('Sulfa allergy: Avoid sulfonamide antibiotics.');
            }
            if (allergies.includes('iodine')) {
                alerts.push('Iodine allergy: Use caution with contrast agents and some antiseptics.');
            }

            // Display alerts if any
            if (alerts.length > 0) {
                const alertsList = document.getElementById('alertsList');
                alertsList.innerHTML = '';
                alerts.forEach(alert => {
                    const li = document.createElement('li');
                    li.textContent = alert;
                    alertsList.appendChild(li);
                });
                document.getElementById('safetyAlerts').style.display = 'block';
            } else {
                document.getElementById('safetyAlerts').style.display = 'none';
            }
        }

        function showPatientInfoSaved() {
            const successMessage = document.createElement('div');
            successMessage.className = 'alert alert-success alert-dismissible fade show position-fixed';
            successMessage.style.top = '20px';
            successMessage.style.right = '20px';
            successMessage.style.zIndex = '9999';
            successMessage.innerHTML = `
                <strong><i class="fas fa-check-circle"></i> Patient Information Saved!</strong>
                <br>Your information will be used for personalized recommendations.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(successMessage);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.remove();
                }
            }, 4000);
        }

        // Load patient info on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPatientInfo();
        });
    </script>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Comparative Medicine Database</h5>
                    <p class="mb-0">Your trusted source for comparative medicine information.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6>Quick Links</h6>
                    <div class="footer-links">
                        <a href="#" class="text-light me-3" data-bs-toggle="modal" data-bs-target="#aboutModal">About Us</a>
                        <a href="#" class="text-light me-3" data-bs-toggle="modal" data-bs-target="#contactModal">Contact</a>
                        <a href="#" class="text-light me-3" data-bs-toggle="modal" data-bs-target="#helpModal">Help</a>
                        <a href="#" class="text-light" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 text-muted">
                        &copy; 2025 Comparative Medicine Database. All rights reserved. 
                        | <a href="#" class="text-light" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a>
                        | For educational purposes only.
                    </p>
                </div>
            </div>
        </div>
    </footer>

</body>

</html>