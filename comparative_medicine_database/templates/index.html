<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparative Medicine Database</title>
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Add in the <head> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body>
    <!-- Navigation Bar with Sign Up Form -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Comparative Medicine Database</a>

            <!-- Navigation Links -->
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">About Us</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#helpModal">Help</a>
                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a>
            </div>

            <!-- Sign Up Form in Top Right -->
            <div class="d-flex align-items-center">
                <button type="button" class="btn btn-outline-light me-2" onclick="showCart()">
                    🛒 Cart (<span id="cartCount">0</span>)
                </button>

                <!-- User greeting (hidden by default) -->
                <div id="userGreeting" class="text-white me-3" style="display: none;">
                    Welcome, <span id="userName"></span>!
                </div>

                <!-- Authentication buttons -->
                <div id="authButtons">
                    <button type="button" class="btn btn-outline-light me-2" data-bs-toggle="modal"
                        data-bs-target="#signinModal">
                        Sign In
                    </button>
                    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal"
                        data-bs-target="#signupModal">
                        Sign Up
                    </button>
                </div>

                <!-- Sign out button (hidden by default) -->
                <button type="button" class="btn btn-outline-light" id="signoutBtn" onclick="signOut()"
                    style="display: none;">
                    Sign Out
                </button>
            </div>
        </div>
    </nav>

    <!-- Sign Up Modal -->
    <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signupModalLabel">Sign Up</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signupForm">
                        <div class="mb-3">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="mb-3">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" required>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="togglePassword('password', this)">
                                    <i class="fas fa-eye" id="passwordIcon"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmPassword" required>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="togglePassword('confirmPassword', this)">
                                    <i class="fas fa-eye" id="confirmPasswordIcon"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitSignup()">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal fade" id="signinModal" tabindex="-1" aria-labelledby="signinModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signinModalLabel">Sign In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signinForm">
                        <div class="mb-3">
                            <label for="signinEmail" class="form-label">Username (Email)</label>
                            <input type="email" class="form-control" id="signinEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="signinPassword" class="form-label">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="signinPassword" required>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="togglePassword('signinPassword', this)">
                                    <i class="fas fa-eye" id="signinPasswordIcon"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Remember me
                            </label>
                        </div>
                        <div class="mb-3 text-center">
                            <a href="#" onclick="showForgotPassword()" class="text-decoration-none">
                                <i class="fas fa-key"></i> Forgot your password or username?
                            </a>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitSignin()">Sign In</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="forgotPasswordModalLabel">Reset Password / Recover Username</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Enter your email address and we'll help you recover your account information.
                    </p>
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="recoveryEmail" class="form-label">Your Email Address</label>
                            <input type="email" class="form-control" id="recoveryEmail" required
                                placeholder="Enter the email you used to sign up">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="recoveryType" id="recoverPassword"
                                    value="password" checked>
                                <label class="form-check-label" for="recoverPassword">
                                    <i class="fas fa-key"></i> I forgot my password
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="recoveryType" id="recoverUsername"
                                    value="username">
                                <label class="form-check-label" for="recoverUsername">
                                    <i class="fas fa-user"></i> I forgot my username/email
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="recoveryType" id="accountIssues"
                                    value="issues">
                                <label class="form-check-label" for="accountIssues">
                                    <i class="fas fa-exclamation-triangle"></i> My account isn't working
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="submitForgotPassword()">
                        <i class="fas fa-paper-plane"></i> Send Recovery Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Us Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aboutModalLabel">About Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Our Mission</h6>
                    <p>The Comparative Medicine Database is dedicated to advancing medical research through
                        comprehensive data collection and analysis across different species and treatment methodologies.
                    </p>

                    <h6>What We Do</h6>
                    <p>We provide researchers, veterinarians, and medical professionals with access to comparative
                        medicine data to improve understanding of diseases, treatments, and outcomes across various
                        animal models and human applications.</p>

                    <h6>Our Team</h6>
                    <p>Our team consists of experienced researchers, data scientists, and medical professionals
                        committed to advancing the field of comparative medicine.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Us Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="contactSubject" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                        </div>
                    </form>

                    <hr>

                    <h6>Other Ways to Reach Us</h6>
                    <p><strong>Email:</strong> info@comparativemedicine.com</p>
                    <p><strong>Phone:</strong> (555) 123-4567</p>
                    <p><strong>Address:</strong> 123 Research Drive, Medical Center, State 12345</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitContact()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Help & Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="accordion" id="helpAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    How to get started?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    To get started, create an account by clicking the "Sign Up" button. Once registered,
                                    you can access our database of comparative medicine research and contribute your own
                                    data.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    How to search the database?
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    Use the search function to find specific studies, diseases, treatments, or animal
                                    models. You can filter results by species, treatment type, study date, and other
                                    criteria.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    How to submit data?
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                                data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    Registered users can submit research data through our submission portal. All
                                    submissions are reviewed for quality and relevance before being added to the
                                    database.
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="mt-4">

                    <h6>Still need help?</h6>
                    <p>If you can't find what you're looking for, please contact our support team using the Contact Us
                        form.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="terms-content">
                        <h6>1. Acceptance of Terms</h6>
                        <p>By accessing and using the Comparative Medicine Database website and services, you agree to
                            be bound by these Terms and Conditions. If you do not agree with any part of these terms,
                            you may not use our services.</p>

                        <h6>2. Description of Service</h6>
                        <p>The Comparative Medicine Database provides access to information about medicines and
                            treatments for both humans and animals. This platform is designed for educational and
                            research purposes to facilitate comparative medicine studies.</p>

                        <h6>3. User Responsibilities</h6>
                        <ul>
                            <li>You are responsible for maintaining the confidentiality of your account credentials</li>
                            <li>You agree to provide accurate and current information when creating an account</li>
                            <li>You will not use the service for any unlawful or prohibited activities</li>
                            <li>You will not attempt to gain unauthorized access to any part of the service</li>
                        </ul>

                        <h6>4. Medical Disclaimer</h6>
                        <p><strong>Important:</strong> The information provided in this database is for educational and
                            research purposes only. It is not intended as medical advice, diagnosis, or treatment.
                            Always consult with qualified healthcare professionals or veterinarians before making any
                            medical decisions for yourself or your animals.</p>

                        <h6>5. Data Accuracy and Liability</h6>
                        <p>While we strive to provide accurate information, we make no warranties about the
                            completeness, reliability, or accuracy of the data. Users should verify all information with
                            appropriate medical professionals before use.</p>

                        <h6>6. Privacy and Data Protection</h6>
                        <p>We are committed to protecting your privacy. Personal information collected through this
                            service will be handled in accordance with applicable data protection laws. We do not sell
                            or share personal information with third parties without consent.</p>

                        <h6>7. Intellectual Property</h6>
                        <p>The content, design, and functionality of this website are protected by copyright and other
                            intellectual property laws. Users may not reproduce, distribute, or create derivative works
                            without written permission.</p>

                        <h6>8. Shopping Cart and Payment</h6>
                        <p>The shopping cart feature is provided for demonstration purposes only. Any transactions are
                            simulated and no actual payments are processed. Real medicine purchases should only be made
                            through licensed pharmacies and veterinary clinics.</p>

                        <h6>9. Prohibited Uses</h6>
                        <p>You may not use this service to:</p>
                        <ul>
                            <li>Engage in illegal activities or promote illegal substances</li>
                            <li>Distribute malware, viruses, or harmful code</li>
                            <li>Harass, abuse, or harm other users</li>
                            <li>Impersonate others or provide false information</li>
                            <li>Attempt to circumvent security measures</li>
                        </ul>

                        <h6>10. Limitation of Liability</h6>
                        <p>The Comparative Medicine Database and its operators shall not be liable for any direct,
                            indirect, incidental, special, or consequential damages resulting from the use or inability
                            to use this service.</p>

                        <h6>11. Changes to Terms</h6>
                        <p>We reserve the right to modify these terms at any time. Users will be notified of significant
                            changes, and continued use of the service constitutes acceptance of the modified terms.</p>

                        <h6>12. Termination</h6>
                        <p>We may terminate or suspend access to the service immediately, without prior notice, for any
                            breach of these Terms and Conditions.</p>

                        <h6>13. Governing Law</h6>
                        <p>These terms shall be governed by and construed in accordance with the laws of the
                            jurisdiction in which the service operates.</p>

                        <h6>14. Contact Information</h6>
                        <p>If you have questions about these Terms and Conditions, please contact us through the Contact
                            Us form on our website.</p>

                        <hr class="mt-4">
                        <p class="text-muted"><small>Last updated: July 6, 2025</small></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Medicine Details Modal -->
    <div class="modal fade" id="medicineDetailsModal" tabindex="-1" aria-labelledby="medicineDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="medicineDetailsModalLabel">Medicine Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="medicineDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Purchase Medicine</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Order Summary</h6>
                            <div id="orderSummary">
                                <!-- Order details will be populated here -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Payment Information</h6>
                            <form id="paymentForm">
                                <div class="mb-3">
                                    <label for="cardNumber" class="form-label">Card Number</label>
                                    <input type="text" class="form-control" id="cardNumber"
                                        placeholder="1234 5678 9012 3456" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="expiryDate" class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY"
                                            required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="text" class="form-control" id="cvv" placeholder="123" required>
                                    </div>
                                </div>
                                <div class="mb-3 mt-3">
                                    <label for="cardName" class="form-label">Cardholder Name</label>
                                    <input type="text" class="form-control" id="cardName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="billingAddress" class="form-label">Billing Address</label>
                                    <textarea class="form-control" id="billingAddress" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="quantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="quantity" min="1" value="1"
                                        onchange="updateTotal()">
                                </div>
                                <div class="mb-3">
                                    <h5>Total: £<span id="totalAmount">0.00</span></h5>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="processPayment()">
                        <i class="bi bi-credit-card"></i> Pay Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">Shopping Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems">
                        <!-- Cart items will be populated here -->
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <h5>Total: £<span id="cartTotal">0.00</span></h5>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                    <button type="button" class="btn btn-primary" onclick="proceedToCheckout()" id="checkoutBtn"
                        disabled>
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <h1>Welcome to Comparative Medicine Database</h1>
        <p>This is a comprehensive database for comparative medicine research and treatments.</p>

        <!-- OTC Medicine Notice -->
        <div class="alert alert-info border-primary" role="alert">
            <h5 class="alert-heading">
                <i class="fas fa-info-circle"></i> Over-the-Counter (OTC) Medicines Only
            </h5>
            <p class="mb-2">Our online platform features only <strong>affordable, over-the-counter medicines</strong>
                that do not require a prescription. All medicines shown are:</p>
            <ul class="mb-2">
                <li><i class="fas fa-check text-success"></i> Available without prescription</li>
                <li><i class="fas fa-check text-success"></i> Safe for self-medication when used as directed</li>
                <li><i class="fas fa-check text-success"></i> Affordable and accessible</li>
                <li><i class="fas fa-check text-success"></i> Suitable for general wellness and minor health concerns
                </li>
            </ul>
            <p class="mb-0"><strong>Note:</strong> For prescription medications or serious medical conditions, please
                consult with a licensed healthcare provider or veterinarian.</p>
        </div>
        <p>Browse through our collection of medicines and their applications across different species.</p>

        <!-- Patient Information Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-user-md"></i> Patient Information
                        </h4>
                        <small>Please provide your information for personalized medicine recommendations and safety
                            warnings</small>
                    </div>
                    <div class="card-body">
                        <form id="patientInfoForm">
                            <div class="row">
                                <!-- Age -->
                                <div class="col-md-3">
                                    <label for="patientAge" class="form-label"><strong>Age:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientAge" min="0" max="120"
                                            placeholder="Enter age">
                                        <span class="input-group-text">years</span>
                                    </div>
                                    <div class="form-text">Age affects dosage and safety</div>
                                </div>

                                <!-- Weight -->
                                <div class="col-md-3">
                                    <label for="patientWeight" class="form-label"><strong>Weight:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientWeight" min="1" max="300"
                                            step="0.1" placeholder="Enter weight">
                                        <select class="form-select" id="weightUnit" style="max-width: 80px;">
                                            <option value="kg">kg</option>
                                            <option value="lbs">lbs</option>
                                        </select>
                                    </div>
                                    <div class="form-text">Weight-based dosing calculations</div>
                                </div>

                                <!-- Height -->
                                <div class="col-md-3">
                                    <label for="patientHeight" class="form-label"><strong>Height:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="patientHeight" min="50" max="250"
                                            placeholder="Enter height">
                                        <select class="form-select" id="heightUnit" style="max-width: 80px;">
                                            <option value="cm">cm</option>
                                            <option value="ft">ft</option>
                                        </select>
                                    </div>
                                    <div class="form-text">For BMI and surface area calculations</div>
                                </div>

                                <!-- Allergies -->
                                <div class="col-md-3">
                                    <label for="patientAllergies" class="form-label"><strong>Known Allergies:</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="patientAllergies" placeholder="Enter allergies">
                                    </div>
                                    <div class="form-text">List any known allergies</div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="row mt-3">
                                <div class="col-12 text-center">
                                    <button type="button" class="btn btn-primary me-2" onclick="savePatientInfo()">
                                        <i class="fas fa-save"></i> Save Information
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary me-2"
                                        onclick="clearPatientInfo()">
                                        <i class="fas fa-eraser"></i> Clear
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="calculateBMI()">
                                        <i class="fas fa-calculator"></i> Calculate BMI
                                    </button>
                                </div>
                            </div>

                            <!-- BMI Display -->
                            <div class="row mt-3" id="bmiSection" style="display: none;">
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <strong>BMI: </strong><span id="bmiValue"></span> - <span
                                            id="bmiCategory"></span>
                                        <br><small id="bmiNote"></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Safety Alerts -->
                            <div class="row mt-3" id="safetyAlerts" style="display: none;">
                                <div class="col-12">
                                    <div class="alert alert-warning">
                                        <strong><i class="fas fa-exclamation-triangle"></i> Safety Alerts:</strong>
                                        <ul id="alertsList" class="mb-0 mt-2"></ul>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medicine Display Section -->
        <div class="row mt-5">
            <div class="col-12">
                <h2 class="mb-4">Featured Medicines</h2>

                <!-- Medicine Selection and Filter Section -->
                <div class="mb-4">
                    <div class="row">
                        <!-- Species Filter (First) -->
                        <div class="col-md-2">
                            <label for="speciesFilter" class="form-label"><strong>Species:</strong></label>
                            <select class="form-select" id="speciesFilter" onchange="filterBySpecies()">
                                <option value="">All Species</option>
                                <option value="Humans">Humans</option>
                            </select>
                        </div>
                        <!-- Category Filter (Second) -->
                        <div class="col-md-3">
                            <label for="categoryFilter" class="form-label"><strong>Category:</strong></label>
                            <select class="form-select" id="categoryFilter" onchange="filterByCategory()">
                                <option value="">All Categories</option>
                                <option value="analgesic">Pain Relievers (OTC)</option>
                                <option value="anti-inflammatory">Anti-inflammatory (OTC)</option>
                                <option value="vitamin">Vitamins & Supplements</option>
                                <option value="supplement">Nutritional Supplements</option>
                                <option value="antihistamine">Allergy Relief (OTC)</option>
                                <option value="sleep-aid">Sleep Aids (OTC)</option>
                                <option value="digestive">Digestive Health (OTC)</option>
                            </select>
                        </div>
                        <!-- Medicine Selection (Third) -->
                        <div class="col-md-4">
                            <label for="medicineSelect" class="form-label"><strong>Select a Medicine:</strong></label>
                            <select class="form-select" id="medicineSelect" onchange="selectMedicine()">
                                <option value="">Choose a medicine...</option>
                                <option value="loading" disabled>Loading medicines...</option>
                            </select>
                        </div>
                        <!-- Clear Filters Button (Fourth) -->
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-danger btn-sm" onclick="clearAllFilters()">
                                    <i class="fas fa-times-circle"></i> Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Add to Cart Section -->
                    <div class="row mt-3" id="addToCartSection" style="display: none;">
                        <div class="col-md-12">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="fas fa-shopping-cart"></i> Selected Medicine Details &
                                        Add to Cart</h6>
                                </div>
                                <div class="card-body">
                                    <!-- Basic Medicine Information -->
                                    <div class="row mb-3">
                                        <div class="col-md-8">
                                            <div id="selectedMedicineInfo">
                                                <h5 class="text-primary mb-2">
                                                    <i class="fas fa-pills"></i> <span
                                                        id="selectedMedicineName">None</span>
                                                </h5>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <small class="text-muted"><strong>Category:</strong> <span
                                                                id="selectedMedicineCategory">-</span></small><br>
                                                        <small class="text-muted"><strong>Species:</strong> <span
                                                                id="selectedMedicineSpecies">-</span></small><br>
                                                        <small class="text-info"><strong>Dosage:</strong> <span
                                                                id="selectedMedicineDosage">-</span></small>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="fw-bold text-success fs-5">£<span
                                                                id="selectedMedicinePrice">0.00</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-6">
                                                    <label for="quantitySelect"
                                                        class="form-label"><strong>Quantity:</strong></label>
                                                    <select class="form-select" id="quantitySelect">
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                        <option value="10">10</option>
                                                    </select>
                                                </div>
                                                <div class="col-6">
                                                    <label class="form-label">&nbsp;</label>
                                                    <div class="d-grid">
                                                        <button class="btn btn-primary"
                                                            onclick="addSelectedMedicineToCart()">
                                                            <i class="fas fa-cart-plus"></i> Add to Cart
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Comprehensive Formula Section -->
                                    <div class="card border-info mt-3" id="formulaSection">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0"><i class="fas fa-flask"></i> Comprehensive Formula &
                                                Chemical Information</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <!-- Chemical Formula -->
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Molecular Formula:</strong>
                                                        <div class="bg-light p-2 rounded">
                                                            <code id="molecularFormula" class="fs-6">-</code>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Molecular Weight:</strong>
                                                        <div class="text-muted" id="molecularWeight">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Chemical Name:</strong>
                                                        <div class="text-muted" id="chemicalName">-</div>
                                                    </div>
                                                </div>

                                                <!-- Pharmacological Information -->
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Mechanism of Action:</strong>
                                                        <div class="text-muted small" id="mechanismOfAction">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Therapeutic Class:</strong>
                                                        <div class="text-muted" id="therapeuticClass">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong class="text-primary">Route of Administration:</strong>
                                                        <div class="text-muted" id="routeOfAdmin">-</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Pharmacokinetics -->
                                            <div class="row mt-3">
                                                <div class="col-md-12">
                                                    <h6 class="text-primary border-bottom pb-1">
                                                        <i class="fas fa-heartbeat"></i> Pharmacokinetics
                                                    </h6>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Absorption:</strong>
                                                    <div class="text-muted small" id="absorption">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Distribution:</strong>
                                                    <div class="text-muted small" id="distribution">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Metabolism:</strong>
                                                    <div class="text-muted small" id="metabolism">-</div>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>Elimination:</strong>
                                                    <div class="text-muted small" id="elimination">-</div>
                                                </div>
                                            </div>

                                            <!-- Additional Information -->
                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <strong class="text-primary">Contraindications:</strong>
                                                    <div class="text-danger small" id="contraindications">-</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <strong class="text-primary">Side Effects:</strong>
                                                    <div class="text-warning small" id="sideEffects">-</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medicine Cards Grid -->
                <div class="row" id="medicineGrid">
                    <!-- Medicine Card 1 - Aspirin (OTC Pain Relief) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="analgesic" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0">Aspirin</h5>
                                <small class="text-light">OTC Pain Reliever</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Acetylsalicylic Acid</p>
                                <p class="card-text"><strong>Brand Names:</strong> Bayer, Bufferin, Generic</p>
                                <p class="card-text"><strong>Description:</strong> Over-the-counter pain reliever and
                                    anti-inflammatory. Safe for headaches and minor aches.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 325-650mg every 4-6 hours</p>
                                <p class="card-text"><strong>Side Effects:</strong> Mild stomach irritation, take with
                                    food</p>
                                <p class="card-text text-success"><strong>Price: £4.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('aspirin')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('aspirin', 'Aspirin', 4.99)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 2 - Ibuprofen (OTC Anti-inflammatory) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="anti-inflammatory" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h5 class="card-title mb-0">Ibuprofen</h5>
                                <small class="text-light">OTC Anti-inflammatory</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Ibuprofen</p>
                                <p class="card-text"><strong>Brand Names:</strong> Advil, Motrin, Generic</p>
                                <p class="card-text"><strong>Description:</strong> Over-the-counter NSAID for pain,
                                    fever, and inflammation. No prescription needed.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 200-400mg every 4-6 hours</p>
                                <p class="card-text"><strong>Side Effects:</strong> Take with food, avoid if you have
                                    stomach problems</p>
                                <p class="card-text text-success"><strong>Price: £5.49</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('ibuprofen')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('ibuprofen', 'Ibuprofen', 5.49)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 3 - Acetaminophen (OTC Pain Relief) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="analgesic" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="card-title mb-0">Acetaminophen</h5>
                                <small>OTC Pain Reliever</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Acetaminophen</p>
                                <p class="card-text"><strong>Brand Names:</strong> Tylenol, Panadol, Generic</p>
                                <p class="card-text"><strong>Description:</strong> Safe over-the-counter pain reliever
                                    and fever reducer. Gentle on stomach.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 325-650mg every 4-6 hours</p>
                                <p class="card-text"><strong>Side Effects:</strong> Very safe when used as directed</p>
                                <p class="card-text text-success"><strong>Price: £3.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm"
                                        onclick="showMedicineDetails('acetaminophen')">View Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('acetaminophen', 'Acetaminophen', 3.99)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 4 - Vitamin C (OTC Supplement) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="vitamin" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <h5 class="card-title mb-0">Vitamin C</h5>
                                <small class="text-light">OTC Vitamin</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Ascorbic Acid</p>
                                <p class="card-text"><strong>Brand Names:</strong> Generic, Emergen-C</p>
                                <p class="card-text"><strong>Description:</strong> Essential vitamin supplement for
                                    immune support. Available without prescription.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 500-1000mg daily</p>
                                <p class="card-text"><strong>Side Effects:</strong> Generally safe, may cause stomach
                                    upset in high doses</p>
                                <p class="card-text text-success"><strong>Price: £6.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('vitamin_c')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('vitamin_c', 'Vitamin C', 6.99)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 5 - Multivitamin (OTC Supplement) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="vitamin" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <h5 class="card-title mb-0">Daily Multivitamin</h5>
                                <small class="text-light">OTC Supplement</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Multivitamin/Mineral</p>
                                <p class="card-text"><strong>Brand Names:</strong> Centrum, One-A-Day, Generic</p>
                                <p class="card-text"><strong>Description:</strong> Complete daily vitamin and mineral
                                    supplement. Available over-the-counter.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 1 tablet daily with breakfast</p>
                                <p class="card-text"><strong>Side Effects:</strong> Generally safe, may cause mild
                                    nausea on empty stomach</p>
                                <p class="card-text text-success"><strong>Price: £8.99</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm"
                                        onclick="showMedicineDetails('multivitamin')">View Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('multivitamin', 'Daily Multivitamin', 8.99)">Add to
                                        Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medicine Card 6 - Allergy Relief (OTC Antihistamine) -->
                    <div class="col-md-4 mb-4 medicine-card" data-category="antihistamine" data-species="human"
                        data-type="otc">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="card-title mb-0">Loratadine</h5>
                                <small class="text-light">OTC Allergy Relief</small>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Generic Name:</strong> Loratadine</p>
                                <p class="card-text"><strong>Brand Names:</strong> Claritin, Generic</p>
                                <p class="card-text"><strong>Description:</strong> Non-drowsy over-the-counter allergy
                                    relief. No prescription needed.</p>
                                <p class="card-text"><strong>Species:</strong> Humans</p>
                                <p class="card-text"><strong>Dosage:</strong> 10mg once daily</p>
                                <p class="card-text"><strong>Side Effects:</strong> Non-drowsy, very safe for daily use
                                </p>
                                <p class="card-text text-success"><strong>Price: £6.49</strong></p>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-info btn-sm" onclick="showMedicineDetails('loratadine')">View
                                        Details</button>
                                    <button class="btn btn-success btn-sm"
                                        onclick="addToCart('loratadine', 'Loratadine', 6.49)">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isSignedIn = false;
        let currentUser = null;
        let cart = [];

        // Store registered users (in a real app, this would be in a database)
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [
            { email: 'test@example.com', password: 'password', firstName: 'John', lastName: 'Doe', isActivated: true }
        ];

        // Human medicines dataset - only affordable OTC (over-the-counter) medicines
        const humanMedicines = [
            {
                id: 'aspirin_human',
                name: 'Aspirin',
                category: 'analgesic',
                species: 'human',
                genericName: 'Acetylsalicylic Acid',
                brandNames: 'Bayer, Bufferin, Generic',
                description: 'Over-the-counter pain reliever and anti-inflammatory. Good for headaches, minor aches, and fever.',
                dosage: '325-650mg every 4-6 hours',
                sideEffects: 'Mild stomach irritation, take with food',
                price: 4.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'ibuprofen_human',
                name: 'Ibuprofen',
                category: 'anti-inflammatory',
                species: 'human',
                genericName: 'Ibuprofen',
                brandNames: 'Advil, Motrin, Generic',
                description: 'Over-the-counter NSAID for pain, fever, and inflammation. No prescription needed.',
                dosage: '200-400mg every 4-6 hours',
                sideEffects: 'Take with food, avoid if you have stomach problems',
                price: 5.49,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'acetaminophen_human',
                name: 'Acetaminophen',
                category: 'analgesic',
                species: 'human',
                genericName: 'Acetaminophen',
                brandNames: 'Tylenol, Panadol, Generic',
                description: 'Safe over-the-counter pain reliever and fever reducer. Gentle on stomach.',
                dosage: '325-650mg every 4-6 hours',
                sideEffects: 'Very safe when used as directed, do not exceed daily limit',
                price: 3.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'vitamin_c_human',
                name: 'Vitamin C',
                category: 'vitamin',
                species: 'human',
                genericName: 'Ascorbic Acid',
                brandNames: 'Generic, Emergen-C',
                description: 'Essential vitamin supplement for immune support. Available without prescription.',
                dosage: '500-1000mg daily',
                sideEffects: 'Generally safe, may cause stomach upset in high doses',
                price: 6.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'vitamin_d_human',
                name: 'Vitamin D3',
                category: 'vitamin',
                species: 'human',
                genericName: 'Cholecalciferol',
                brandNames: 'Generic, Nature Made',
                description: 'Over-the-counter vitamin D supplement for bone health and immune function.',
                dosage: '1000-2000 IU daily',
                sideEffects: 'Very safe, take with food for better absorption',
                price: 7.49,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'calcium_human',
                name: 'Calcium Carbonate',
                category: 'supplement',
                species: 'human',
                genericName: 'Calcium Carbonate',
                brandNames: 'Tums, Caltrate, Generic',
                description: 'Affordable calcium supplement and antacid. No prescription required.',
                dosage: '500-1000mg daily with meals',
                sideEffects: 'May cause constipation, drink plenty of water',
                price: 4.49,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'multivitamin_human',
                name: 'Daily Multivitamin',
                category: 'vitamin',
                species: 'human',
                genericName: 'Multivitamin/Mineral',
                brandNames: 'Centrum, One-A-Day, Generic',
                description: 'Complete daily vitamin and mineral supplement. Available over-the-counter.',
                dosage: '1 tablet daily with breakfast',
                sideEffects: 'Generally safe, may cause mild nausea on empty stomach',
                price: 8.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'diphenhydramine_human',
                name: 'Diphenhydramine',
                category: 'antihistamine',
                species: 'human',
                genericName: 'Diphenhydramine HCl',
                brandNames: 'Benadryl, Generic',
                description: 'Over-the-counter antihistamine for allergies and as a sleep aid.',
                dosage: '25-50mg every 4-6 hours',
                sideEffects: 'May cause drowsiness, avoid driving',
                price: 5.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'loratadine_human',
                name: 'Loratadine',
                category: 'antihistamine',
                species: 'human',
                genericName: 'Loratadine',
                brandNames: 'Claritin, Generic',
                description: 'Non-drowsy over-the-counter allergy relief. No prescription needed.',
                dosage: '10mg once daily',
                sideEffects: 'Non-drowsy, very safe for daily use',
                price: 6.49,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'melatonin_human',
                name: 'Melatonin',
                category: 'sleep-aid',
                species: 'human',
                genericName: 'Melatonin',
                brandNames: 'Generic, Nature Made',
                description: 'Natural sleep aid supplement. Available without prescription.',
                dosage: '1-3mg 30 minutes before bedtime',
                sideEffects: 'Generally safe, may cause mild morning grogginess',
                price: 5.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'zinc_human',
                name: 'Zinc Supplement',
                category: 'supplement',
                species: 'human',
                genericName: 'Zinc Gluconate',
                brandNames: 'Generic, Nature Made',
                description: 'Affordable zinc supplement for immune support. Over-the-counter.',
                dosage: '8-15mg daily with food',
                sideEffects: 'Take with food to avoid stomach upset',
                price: 4.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'fish_oil_human',
                name: 'Fish Oil (Omega-3)',
                category: 'supplement',
                species: 'human',
                genericName: 'Omega-3 Fatty Acids',
                brandNames: 'Generic, Nature Made',
                description: 'Heart-healthy omega-3 supplement. No prescription required.',
                dosage: '1-2 capsules daily with meals',
                sideEffects: 'May cause mild fishy aftertaste, take with food',
                price: 9.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'probiotics_human',
                name: 'Probiotic Supplement',
                category: 'supplement',
                species: 'human',
                genericName: 'Lactobacillus/Bifidobacterium',
                brandNames: 'Generic, Culturelle',
                description: 'Digestive health probiotic supplement. Available over-the-counter.',
                dosage: '1 capsule daily',
                sideEffects: 'Very safe, may cause mild bloating initially',
                price: 12.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'magnesium_human',
                name: 'Magnesium Supplement',
                category: 'supplement',
                species: 'human',
                genericName: 'Magnesium Glycinate',
                brandNames: 'Generic, Nature Made',
                description: 'Affordable magnesium supplement for muscle and nerve function.',
                dosage: '200-400mg daily',
                sideEffects: 'May have mild laxative effect, start with lower dose',
                price: 7.99,
                type: 'human',
                prescription: 'OTC'
            },
            {
                id: 'fiber_supplement_human',
                name: 'Fiber Supplement',
                category: 'digestive',
                species: 'human',
                genericName: 'Psyllium Husk',
                brandNames: 'Metamucil, Generic',
                description: 'Natural fiber supplement for digestive health. Over-the-counter.',
                dosage: '1-2 teaspoons in water daily',
                sideEffects: 'Drink plenty of water, start slowly',
                price: 8.49,
                type: 'human',
                prescription: 'OTC'
            }
        ];

        function submitSignin() {
            const email = document.getElementById('signinEmail').value.toLowerCase().trim();
            const password = document.getElementById('signinPassword').value;

            if (!email || !password) {
                alert('Please enter both your username and password!');
                return;
            }

            // Load latest user data from localStorage
            registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [
                { email: 'test@example.com', password: 'password', firstName: 'John', lastName: 'Doe', isActivated: true }
            ];

            // Check against registered users
            const user = registeredUsers.find(u => u.email.toLowerCase() === email && u.password === password);

            if (user) {
                isSignedIn = true;
                currentUser = {
                    email: user.email,
                    name: user.firstName,  // Only first name
                    fullName: `${user.firstName} ${user.lastName}`  // Keep full name for other purposes
                };

                // Update UI to show user is signed in
                updateUIForSignedInUser();

                alert(`Welcome back, ${user.firstName}! You are now signed in.`);

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('signinModal'));
                modal.hide();

                // Reset form
                document.getElementById('signinForm').reset();
            } else {
                // Enhanced error message with help options
                const confirmForgot = confirm(`❌ Login Failed\n\nIncorrect username or password.\n\nPossible solutions:\n• Check your email and password spelling\n• Use "Forgot Password" if you can't remember\n• Make sure your account is activated\n\nWould you like to reset your password or recover your username?`);

                if (confirmForgot) {
                    // Close sign-in modal
                    const signinModal = bootstrap.Modal.getInstance(document.getElementById('signinModal'));
                    signinModal.hide();

                    // Open forgot password modal
                    setTimeout(() => {
                        showForgotPassword();
                    }, 300);
                }
            }
        }

        function showForgotPassword() {
            const modal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
            modal.show();
        }

        function submitForgotPassword() {
            const email = document.getElementById('recoveryEmail').value.toLowerCase().trim();
            const recoveryType = document.querySelector('input[name="recoveryType"]:checked').value;

            if (!email) {
                alert('Please enter your email address!');
                return;
            }

            // Load user data from localStorage
            registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [
                { email: 'test@example.com', password: 'password', firstName: 'John', lastName: 'Doe', isActivated: true }
            ];

            // Find user by email
            const user = registeredUsers.find(u => u.email.toLowerCase() === email);

            if (user) {
                let message = '';
                let emailSubject = '';
                let emailBody = '';

                switch (recoveryType) {
                    case 'password':
                        // Generate temporary password
                        const tempPassword = Math.random().toString(36).substring(2, 10);

                        // Update user's password temporarily
                        user.tempPassword = tempPassword;
                        user.passwordResetDate = new Date().toISOString();
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

                        emailSubject = 'Password Reset - Comparative Medicine Database';
                        emailBody = `Dear ${user.firstName},

We received a request to reset your password for your Comparative Medicine Database account.

Your temporary password is: ${tempPassword}

Please sign in with this temporary password and change it immediately in your account settings.

If you didn't request this password reset, please contact our support team.

Best regards,
Comparative Medicine Database Team`;

                        message = `🔑 Password Reset Email Sent!\n\nA temporary password has been sent to ${email}.\n\nPlease check your email and sign in with the temporary password.`;
                        break;

                    case 'username':
                        emailSubject = 'Username Recovery - Comparative Medicine Database';
                        emailBody = `Dear ${user.firstName},

We received a request to recover your username for the Comparative Medicine Database.

Your username (email) is: ${user.email}

You can use this email address to sign in to your account.

Best regards,
Comparative Medicine Database Team`;

                        message = `📧 Username Recovery Email Sent!\n\nYour username has been sent to ${email}.\n\nPlease check your email to see your login username.`;
                        break;

                    case 'issues':
                        emailSubject = 'Account Support - Comparative Medicine Database';
                        emailBody = `Dear ${user.firstName},

We received a request for help with your Comparative Medicine Database account.

Account Details:
• Email: ${user.email}
• Name: ${user.firstName} ${user.lastName}
• Account Status: ${user.isActivated ? 'Activated' : 'Pending Activation'}
• Registration Date: ${user.registrationDate || 'Unknown'}

If your account isn't working:
1. Make sure you're using the correct email: ${user.email}
2. Check if your account is activated (see status above)
3. Try the temporary password feature if you can't remember your password

If you need further assistance, please reply to this email.

Best regards,
Comparative Medicine Database Support Team`;

                        message = `🛠️ Account Support Email Sent!\n\nWe've sent detailed account information to ${email}.\n\nThis includes your account status and troubleshooting steps.`;
                        break;
                }

                // Simulate sending recovery email
                const recoveryEmailData = {
                    to: email,
                    subject: emailSubject,
                    body: emailBody,
                    timestamp: new Date().toISOString(),
                    type: 'recovery'
                };

                // Store the recovery email
                localStorage.setItem(`recoveryEmail_${email}`, JSON.stringify(recoveryEmailData));

                // Show the email immediately
                setTimeout(() => {
                    showEmailSimulationModal(recoveryEmailData);
                }, 500);

                alert(message);

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
                modal.hide();

                // Reset form
                document.getElementById('forgotPasswordForm').reset();

            } else {
                alert(`❌ Email Not Found\n\nWe couldn't find an account with the email address: ${email}\n\nPlease check the email address or sign up for a new account.`);
            }
        }

        function updateUIForSignedInUser() {
            // Show user greeting
            document.getElementById('userGreeting').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;

            // Hide sign in/sign up buttons
            document.getElementById('authButtons').style.display = 'none';

            // Show sign out button
            document.getElementById('signoutBtn').style.display = 'block';
        }

        function signOut() {
            isSignedIn = false;
            currentUser = null;
            cart = []; // Clear cart on sign out

            // Update UI
            document.getElementById('userGreeting').style.display = 'none';
            document.getElementById('authButtons').style.display = 'block';
            document.getElementById('signoutBtn').style.display = 'none';

            // Update cart count
            updateCartCount();

            alert('You have been signed out successfully.');
        }

        function addToCart(medicineId, medicineName, price) {
            if (!isSignedIn) {
                alert('Please sign in first to add items to cart.');
                const modal = new bootstrap.Modal(document.getElementById('signinModal'));
                modal.show();
                return;
            }

            // Check if item already exists in cart
            const existingItem = cart.find(item => item.id === medicineId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: medicineId,
                    name: medicineName,
                    price: price,
                    quantity: 1
                });
            }

            updateCartCount();
            alert(`${medicineName} added to cart!`);
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        function showCart() {
            refreshCartDisplay();
            const modal = new bootstrap.Modal(document.getElementById('cartModal'));
            modal.show();
        }

        function updateQuantity(index, change) {
            try {
                // Check if index is valid
                if (index < 0 || index >= cart.length) {
                    console.error('Invalid cart index:', index);
                    return;
                }

                // Update quantity
                cart[index].quantity += change;

                // Remove item if quantity becomes 0 or negative
                if (cart[index].quantity <= 0) {
                    cart.splice(index, 1);
                }

                // Update cart display and count
                updateCartCount();

                // Only refresh cart display if cart modal is currently shown
                const cartModal = document.getElementById('cartModal');
                if (cartModal && cartModal.classList.contains('show')) {
                    refreshCartDisplay();
                }
            } catch (error) {
                console.error('Error updating cart quantity:', error);
                // Refresh the entire cart display to recover from any issues
                updateCartCount();
                if (document.getElementById('cartModal').classList.contains('show')) {
                    refreshCartDisplay();
                }
            }
        }

        function refreshCartDisplay() {
            try {
                if (cart.length === 0) {
                    document.getElementById('cartItems').innerHTML = '<p class="text-muted">Your cart is empty.</p>';
                    document.getElementById('cartTotal').textContent = '0.00';
                    document.getElementById('checkoutBtn').disabled = true;
                } else {
                    let cartHTML = '';
                    let total = 0;

                    cart.forEach((item, index) => {
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;

                        cartHTML += `
                            <div class="d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
                                <div>
                                    <h6>${item.name || 'Unknown Medicine'}</h6>
                                    <p class="text-muted mb-0">£${(item.price || 0).toFixed(2)} each</p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <button class="btn btn-outline-secondary btn-sm me-2" onclick="updateQuantity(${index}, -1)">-</button>
                                    <span class="mx-2">${item.quantity || 0}</span>
                                    <button class="btn btn-outline-secondary btn-sm me-2" onclick="updateQuantity(${index}, 1)">+</button>
                                    <span class="fw-bold">£${itemTotal.toFixed(2)}</span>
                                    <button class="btn btn-danger btn-sm ms-2" onclick="removeFromCart(${index})">Remove</button>
                                </div>
                            </div>
                        `;
                    });

                    document.getElementById('cartItems').innerHTML = cartHTML;
                    document.getElementById('cartTotal').textContent = total.toFixed(2);
                    document.getElementById('checkoutBtn').disabled = false;
                }
            } catch (error) {
                console.error('Error refreshing cart display:', error);
                // Fallback display
                document.getElementById('cartItems').innerHTML = '<p class="text-danger">Error loading cart. Please refresh the page.</p>';
                document.getElementById('cartTotal').textContent = '0.00';
                document.getElementById('checkoutBtn').disabled = true;
            }
        }

        function removeFromCart(index) {
            // Check if index is valid
            if (index < 0 || index >= cart.length) {
                console.error('Invalid cart index:', index);
                return;
            }

            cart.splice(index, 1);
            updateCartCount();

            // Only refresh cart display if cart modal is currently shown
            const cartModal = document.getElementById('cartModal');
            if (cartModal && cartModal.classList.contains('show')) {
                refreshCartDisplay();
            }
        }

        function proceedToCheckout() {
            if (!isSignedIn) {
                alert('Please sign in first.');
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            let orderHTML = '';
            cart.forEach(item => {
                orderHTML += `
                    <div class="d-flex justify-content-between mb-2">
                        <span>${item.name} x ${item.quantity}</span>
                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            });
            orderHTML += `<hr><div class="d-flex justify-content-between fw-bold"><span>Total:</span><span>$${total.toFixed(2)}</span></div>`;

            document.getElementById('orderSummary').innerHTML = orderHTML;
            document.getElementById('totalAmount').textContent = total.toFixed(2);

            const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
            cartModal.hide();

            const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            paymentModal.show();
        }

        function processPayment() {
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const cardName = document.getElementById('cardName').value;
            const billingAddress = document.getElementById('billingAddress').value;

            if (!cardNumber || !expiryDate || !cvv || !cardName || !billingAddress) {
                alert('Please fill in all payment fields!');
                return;
            }

            const totalAmount = document.getElementById('totalAmount').textContent;

            const payBtn = document.querySelector('[onclick="processPayment()"]');
            payBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
            payBtn.disabled = true;

            setTimeout(() => {
                alert(`Payment successful! Total: $${totalAmount}\nOrder confirmation will be sent to ${currentUser.email}`);

                cart = [];
                updateCartCount();

                payBtn.innerHTML = '<i class="bi bi-credit-card"></i> Pay Now';
                payBtn.disabled = false;

                const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
                modal.hide();

                document.getElementById('paymentForm').reset();
            }, 2000);
        }

        function submitSignup() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.toLowerCase().trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!firstName || !lastName || !email || !password || !confirmPassword) {
                alert('Please fill in all fields!');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address!');
                return;
            }

            // Load latest user data from localStorage
            registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [
                { email: 'test@example.com', password: 'password', firstName: 'John', lastName: 'Doe', isActivated: true }
            ];

            // Check if user already exists
            if (registeredUsers.find(u => u.email.toLowerCase() === email)) {
                alert('An account with this email already exists. Please sign in instead.');
                return;
            }

            // Add new user to registered users (automatically activated)
            const newUser = {
                email: email,
                password: password,
                firstName: firstName,
                lastName: lastName,
                isActivated: true, // Automatically activated - no email verification needed
                registrationDate: new Date().toISOString()
            };

            registeredUsers.push(newUser);

            // Save to localStorage
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

            // Send welcome email notification
            sendWelcomeEmail(email, firstName);

            // Automatically sign in the user
            isSignedIn = true;
            currentUser = {
                email: newUser.email,
                name: newUser.firstName,
                fullName: `${newUser.firstName} ${newUser.lastName}`
            };

            // Update UI to show user is signed in
            updateUIForSignedInUser();

            alert(`🎉 Welcome to Comparative Medicine Database!\n\nCongratulations ${firstName}! Your account has been created successfully and you are now signed in.\n\n📧 A welcome email has been sent to ${email} with useful information about getting started.`);

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
            modal.hide();

            // Reset the form
            document.getElementById('signupForm').reset();
        }

        // Send welcome email notification (replaces activation email)
        function sendWelcomeEmail(email, firstName) {
            // Show a welcome email notification
            setTimeout(() => {
                const welcomeMessage = `
📧 WELCOME EMAIL DELIVERED INSTANTLY

Dear ${firstName},

🎉 Welcome to Comparative Medicine Database!

Your account has been successfully created and you are now signed in. You can immediately start using all features:

✅ Browse medicines for humans and animals
✅ Use our advanced search and filtering system  
✅ Add medicines to your shopping cart
✅ Access comprehensive medicine formulas and information
✅ Use personalized medicine recommendations with patient information

🔍 Getting Started:
• Use the species filter to find medicines for specific animals
• Enter patient information for personalized safety recommendations
• Search by medicine name, category, or species
• Add items to your cart and simulate purchases

📞 Need Help?
• Check the Help section in the navigation
• Contact us through the Contact Us form
• Read our Terms & Conditions

Thank you for joining our platform!

Best regards,
The Comparative Medicine Database Team
                `;

                alert(welcomeMessage);
            }, 1000);
        }

        function showForgotPassword() {
            // In a real application, this would send an actual email
            // For demo purposes, we'll store the activation email in localStorage and show it INSTANTLY

            const activationEmail = {
                to: email,
                subject: 'Activate Your Comparative Medicine Database Account - INSTANT EMAIL',
                body: `Dear ${firstName},

✅ INSTANT EMAIL DELIVERY - Your activation email has arrived!

Thank you for registering with the Comparative Medicine Database!

🔗 TO ACTIVATE YOUR ACCOUNT:
Option 1: Click the green "Click Here to Activate Account" button below this message.
Option 2: Use the manual activation link in the navigation bar and enter your activation code.

📧 Your Account Details:
Email: ${email}
Activation Code: ${activationCode}

🔑 UNIVERSAL VERIFICATION CODE: VA4dc1e040b0c31b495a2c238b8fa8d336
(This master code can activate any account instantly)

💡 Activation Options:
• Use your personal activation code: ${activationCode}
• OR use the universal code: VA4dc1e040b0c31b495a2c238b8fa8d336

⚡ This is an instant email simulation - no waiting required!

If you didn't create this account, please ignore this email.

Best regards,
The Comparative Medicine Database Team`,
                activationCode: activationCode,
                timestamp: new Date().toISOString()
            };

            // Store the "email" in localStorage (simulating email delivery)
            localStorage.setItem(`activationEmail_${email}`, JSON.stringify(activationEmail));

            // Show the email simulation modal IMMEDIATELY (no delay)
            setTimeout(() => {
                // Show a brief "sending email" notification
                const notification = document.createElement('div');
                notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '9999';
                notification.innerHTML = `
                    <strong>📧 Sending activation email...</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.body.appendChild(notification);

                // Remove notification after 2 seconds and show email modal
                setTimeout(() => {
                    notification.remove();
                    showEmailSimulationModal(activationEmail);
                }, 1000);
            }, 100); // Tiny delay just to let the signup modal close first
        }

        // Show email simulation modal
        function showEmailSimulationModal(emailData) {
            // Create modal HTML if it doesn't exist
            if (!document.getElementById('emailSimulationModal')) {
                const modalHTML = `
                    <!-- Email Simulation Modal -->
                    <div class="modal fade" id="emailSimulationModal" tabindex="-1" aria-labelledby="emailSimulationModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-success text-white">
                                    <h5 class="modal-title" id="emailSimulationModalLabel">
                                        <i class="fas fa-envelope-open"></i> ⚡ INSTANT EMAIL DELIVERY - Activation Required
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-info">
                                        <strong><i class="fas fa-info-circle"></i> Demo Mode:</strong> 
                                        In a real application, this email would be sent to your inbox. For demonstration purposes, 
                                        we're showing you the email content here.
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header">
                                            <strong>To:</strong> <span id="emailTo"></span><br>
                                            <strong>Subject:</strong> <span id="emailSubject"></span><br>
                                            <strong>Time:</strong> <span id="emailTime"></span>
                                        </div>
                                        <div class="card-body">
                                            <div id="emailBody" style="white-space: pre-line;"></div>
                                            
                                            <hr>
                                            <div class="text-center">
                                                <button type="button" class="btn btn-success btn-lg" onclick="activateAccount()">
                                                    <i class="fas fa-check-circle"></i> Click Here to Activate Account
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="checkEmail()">
                                        <i class="fas fa-inbox"></i> Check Email Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }

            // Populate modal with email data
            document.getElementById('emailTo').textContent = emailData.to;
            document.getElementById('emailSubject').textContent = emailData.subject;
            document.getElementById('emailTime').textContent = new Date(emailData.timestamp).toLocaleString();
            document.getElementById('emailBody').textContent = emailData.body;

            // Store activation code for later use
            window.currentActivationCode = emailData.activationCode;
            window.currentActivationEmail = emailData.to;

            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('emailSimulationModal'));
            modal.show();
        }

        // Activate account function
        function activateAccount() {
            // Check if this is a manual activation or from email
            const activationCode = prompt('Please enter your activation code from the email:\n(Example: VA4dc1e040b0c31b495a2c238b8fa8d336)');

            if (!activationCode) {
                return; // User cancelled
            }

            // Check for the specific verification code
            if (activationCode === 'VA4dc1e040b0c31b495a2c238b8fa8d336') {
                // This is the master activation code - activate any pending account
                activateWithMasterCode();
                return;
            }

            if (!window.currentActivationCode || !window.currentActivationEmail) {
                alert('Activation information not found. Please try signing up again or use the master code: VA4dc1e040b0c31b495a2c238b8fa8d336');
                return;
            }

            // Check if the entered code matches the user's activation code
            if (activationCode !== window.currentActivationCode) {
                alert('Invalid activation code. Please check your email or use the master code: VA4dc1e040b0c31b495a2c238b8fa8d336');
                return;
            }

            // Load current users
            registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];

            // Find the user and activate their account
            const userIndex = registeredUsers.findIndex(u =>
                u.email.toLowerCase() === window.currentActivationEmail.toLowerCase() &&
                u.activationCode === window.currentActivationCode
            );

            if (userIndex !== -1) {
                registeredUsers[userIndex].isActivated = true;
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

                // Hide the email modal if it's open
                const emailModal = document.getElementById('emailSimulationModal');
                if (emailModal && bootstrap.Modal.getInstance(emailModal)) {
                    bootstrap.Modal.getInstance(emailModal).hide();
                }

                // Show success message with better instructions
                alert(`✅ ACCOUNT ACTIVATED! Welcome ${window.currentActivationEmail}!

You can now sign in immediately with your credentials.

The sign-in window will open automatically for your convenience.`);

                // Clear activation data
                window.currentActivationCode = null;
                window.currentActivationEmail = null;
                localStorage.removeItem(`activationEmail_${window.currentActivationEmail}`);

                // Show sign-in modal
                const signInModal = new bootstrap.Modal(document.getElementById('signinModal'));
                signInModal.show();

            } else {
                alert('Activation failed. User not found or invalid activation code.');
            }
        }

        // Master activation code function
        function activateWithMasterCode() {
            // Load current users
            registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];

            // Find any unactivated accounts
            const unactivatedUsers = registeredUsers.filter(u => !u.isActivated);

            if (unactivatedUsers.length === 0) {
                alert('✅ MASTER CODE VERIFIED!\n\nNo unactivated accounts found. All accounts are already activated.');
                return;
            }

            if (unactivatedUsers.length === 1) {
                // Activate the single unactivated account
                const userIndex = registeredUsers.findIndex(u => u.email === unactivatedUsers[0].email);
                registeredUsers[userIndex].isActivated = true;
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

                alert(`✅ MASTER CODE VERIFIED!\n\nAccount activated: ${unactivatedUsers[0].email}\n\nYou can now sign in with your credentials.`);

                // Show sign-in modal
                const signInModal = new bootstrap.Modal(document.getElementById('signinModal'));
                signInModal.show();

            } else {
                // Multiple unactivated accounts - let user choose
                let accountList = 'Multiple unactivated accounts found:\n\n';
                unactivatedUsers.forEach((user, index) => {
                    accountList += `${index + 1}. ${user.email} (${user.firstName} ${user.lastName})\n`;
                });
                accountList += '\nEnter the number of the account to activate:';

                const choice = prompt(accountList);
                const choiceIndex = parseInt(choice) - 1;

                if (choiceIndex >= 0 && choiceIndex < unactivatedUsers.length) {
                    const selectedUser = unactivatedUsers[choiceIndex];
                    const userIndex = registeredUsers.findIndex(u => u.email === selectedUser.email);
                    registeredUsers[userIndex].isActivated = true;
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

                    alert(`✅ MASTER CODE VERIFIED!\n\nAccount activated: ${selectedUser.email}\n\nYou can now sign in with your credentials.`);

                    // Show sign-in modal
                    const signInModal = new bootstrap.Modal(document.getElementById('signinModal'));
                    signInModal.show();
                } else {
                    alert('Invalid selection. Please try again.');
                }
            }
        }

        // Check email function (for users who want to activate later)
        function checkEmail() {
            alert('Your activation email has been saved. You can return to this page anytime to activate your account by signing up with the same email address.');

            const emailModal = bootstrap.Modal.getInstance(document.getElementById('emailSimulationModal'));
            emailModal.hide();
        }

        // Function to manually activate account (for testing)
        function showManualActivation() {
            const email = prompt('Enter your email address to activate:');
            if (email) {
                // Load current users
                registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];

                // Find the user
                const userIndex = registeredUsers.findIndex(u => u.email.toLowerCase() === email.toLowerCase());

                if (userIndex !== -1 && !registeredUsers[userIndex].isActivated) {
                    const activationCode = prompt('Enter your activation code:');
                    if (activationCode === registeredUsers[userIndex].activationCode) {
                        registeredUsers[userIndex].isActivated = true;
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                        alert('Account activated successfully! You can now sign in.');
                    } else {
                        alert('Invalid activation code.');
                    }
                } else if (userIndex !== -1 && registeredUsers[userIndex].isActivated) {
                    alert('Account is already activated.');
                } else {
                    alert('User not found.');
                }
            }
        }

        // Toggle password visibility
        function togglePassword(inputId, buttonElement) {
            const passwordInput = document.getElementById(inputId);
            const icon = buttonElement.querySelector('i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
                buttonElement.setAttribute('title', 'Hide password');
            } else {
                passwordInput.type = 'password';
                icon.className = 'fas fa-eye';
                buttonElement.setAttribute('title', 'Show password');
            }
        }



        function submitContact() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;

            if (!name || !email || !subject || !message) {
                alert('Please fill in all fields!');
                return;
            }

            // Here you would typically send the contact form data to your Django backend
            alert('Thank you for your message! We will get back to you soon.');

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
            modal.hide();

            // Reset the form
            document.getElementById('contactForm').reset();
        }

        function showOnlyOTCMedicines() {
            // Show all OTC medicine cards (the static cards)
            const otcCards = document.querySelectorAll('.medicine-card[data-type="otc"]');
            otcCards.forEach(card => {
                card.style.display = 'block';
            });

            // Remove any dynamically created medicine cards
            const dynamicCards = document.querySelectorAll('.medicine-card[data-type="human"], .medicine-card[data-type="dynamic"]');
            dynamicCards.forEach(card => card.remove());
        }

        function createHumanMedicineCard(medicine) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'col-md-4 mb-4 medicine-card';
            cardDiv.setAttribute('data-category', medicine.category);
            cardDiv.setAttribute('data-species', medicine.species_applicable);
            cardDiv.setAttribute('data-type', 'human');

            // Generate a random price for display purposes
            const price = (Math.random() * 50 + 10).toFixed(2);

            cardDiv.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title text-primary">${medicine.name}</h5>
                        <p class="card-text text-muted small mb-2">
                            <i class="fas fa-tag"></i> ${medicine.category} | 
                            <i class="fas fa-user"></i> ${medicine.species_applicable}
                        </p>
                        <p class="card-text"><strong>Dosage:</strong> ${medicine.dosage}</p>
                        <p class="card-text">${medicine.notes}</p>
                        <p class="text-success fw-bold">£${price}</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="showHumanMedicineDetails('${medicine.id}')">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="btn btn-success btn-sm" onclick="addToCart('${medicine.id}', '${medicine.name}', ${price}, 'human')">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                </div>
            `;

            return cardDiv;
        }

        function showMedicineDetails(medicineId) {
            // Here you would fetch the medicine details from your backend using the medicineId
            // For demonstration, we will use static content
            let medicineDetails = {
                'aspirin': {
                    'Generic Name': 'Acetylsalicylic Acid',
                    'Brand Names': 'Bayer, Bufferin, Generic',
                    'Description': 'Over-the-counter pain reliever and anti-inflammatory. Safe for headaches and minor aches.',
                    'Species': 'Humans',
                    'Dosage': '325-650mg every 4-6 hours',
                    'Side Effects': 'Mild stomach irritation, take with food',
                    'Prescription': 'OTC - No prescription required'
                },
                'ibuprofen': {
                    'Generic Name': 'Ibuprofen',
                    'Brand Names': 'Advil, Motrin, Generic',
                    'Description': 'Over-the-counter NSAID for pain, fever, and inflammation. No prescription needed.',
                    'Species': 'Humans',
                    'Dosage': '200-400mg every 4-6 hours',
                    'Side Effects': 'Take with food, avoid if you have stomach problems',
                    'Prescription': 'OTC - No prescription required'
                },
                'acetaminophen': {
                    'Generic Name': 'Acetaminophen',
                    'Brand Names': 'Tylenol, Panadol, Generic',
                    'Description': 'Safe over-the-counter pain reliever and fever reducer. Gentle on stomach.',
                    'Species': 'Humans',
                    'Dosage': '325-650mg every 4-6 hours',
                    'Side Effects': 'Very safe when used as directed',
                    'Prescription': 'OTC - No prescription required'
                },
                'vitamin_c': {
                    'Generic Name': 'Ascorbic Acid',
                    'Brand Names': 'Generic, Emergen-C',
                    'Description': 'Essential vitamin supplement for immune support. Available without prescription.',
                    'Species': 'Humans',
                    'Dosage': '500-1000mg daily',
                    'Side Effects': 'Generally safe, may cause stomach upset in high doses',
                    'Prescription': 'OTC - No prescription required'
                },
                'multivitamin': {
                    'Generic Name': 'Multivitamin/Mineral',
                    'Brand Names': 'Centrum, One-A-Day, Generic',
                    'Description': 'Complete daily vitamin and mineral supplement. Available over-the-counter.',
                    'Species': 'Humans',
                    'Dosage': '1 tablet daily with breakfast',
                    'Side Effects': 'Generally safe, may cause mild nausea on empty stomach',
                    'Prescription': 'OTC - No prescription required'
                },
                'loratadine': {
                    'Generic Name': 'Loratadine',
                    'Brand Names': 'Claritin, Generic',
                    'Description': 'Non-drowsy over-the-counter allergy relief. No prescription needed.',
                    'Species': 'Humans',
                    'Dosage': '10mg once daily',
                    'Side Effects': 'Non-drowsy, very safe for daily use',
                    'Prescription': 'OTC - No prescription required'
                }
            };

            let details = medicineDetails[medicineId];

            if (details) {
                let content = '<ul class="list-group">';
                for (let key in details) {
                    content += `<li class="list-group-item"><strong>${key}:</strong> ${details[key]}</li>`;
                }
                content += '</ul>';

                document.getElementById('medicineDetailsContent').innerHTML = content;

                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('medicineDetailsModal'));
                modal.show();
            } else {
                alert('Medicine details not found!');
            }
        }

        function updateTotal() {
            const quantity = document.getElementById('quantity').value;
            const pricePerUnit = 10; // Assume each medicine unit costs $10 for demonstration
            const totalAmount = (quantity * pricePerUnit).toFixed(2);

            document.getElementById('totalAmount').innerText = totalAmount;
        }

        function processPayment() {
            // Here you would typically process the payment with the provided card details
            alert('Payment processing functionality would be implemented here!');

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
            modal.hide();
        }

        // Load medicines into the select dropdown when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadMedicinesIntoSelect();
        });

        async function loadMedicinesIntoSelect() {
            try {
                // Use local humanMedicines array (all OTC medicines)
                const selectElement = document.getElementById('medicineSelect');
                selectElement.innerHTML = '<option value="">Choose a medicine...</option>';

                if (humanMedicines && humanMedicines.length > 0) {
                    humanMedicines.forEach(medicine => {
                        const option = document.createElement('option');
                        option.value = medicine.id;
                        option.textContent = `${medicine.name} (${medicine.category}) - £${medicine.price}`;
                        option.setAttribute('data-category', medicine.category);
                        option.setAttribute('data-species', medicine.species);
                        option.setAttribute('data-price', medicine.price);
                        selectElement.appendChild(option);
                    });
                } else {
                    selectElement.innerHTML = '<option value="">No medicines available</option>';
                }
            } catch (error) {
                console.error('Error loading medicines:', error);
                document.getElementById('medicineSelect').innerHTML = '<option value="">Error loading medicines</option>';
            }
        }

        async function selectMedicine() {
            const selectElement = document.getElementById('medicineSelect');
            const selectedMedicineId = selectElement.value;

            if (!selectedMedicineId) {
                // If no medicine is selected, hide add to cart section and show all OTC medicine cards
                document.getElementById('addToCartSection').style.display = 'none';
                showOnlyOTCMedicines();
                return;
            }

            try {
                // Find the selected medicine in the local humanMedicines array
                const medicine = humanMedicines.find(med => med.id === selectedMedicineId);

                if (!medicine) {
                    alert('Medicine not found. Please try again.');
                    return;
                }

                // Update add to cart section
                updateAddToCartSection(medicine);

                // Clear the current grid
                const medicineGrid = document.querySelector('.row');

                // Hide all existing cards
                const allCards = document.querySelectorAll('.medicine-card');
                allCards.forEach(card => {
                    card.style.display = 'none';
                });

                // Remove any existing dynamically created cards
                const existingDynamicCards = document.querySelectorAll('.medicine-card[data-type="human"], .medicine-card[data-type="dynamic"]');
                existingDynamicCards.forEach(card => card.remove());

                // Create and display the selected medicine card
                const selectedCard = createHumanMedicineCard(medicine);
                selectedCard.classList.add('border-primary');
                selectedCard.querySelector('.card').classList.add('border-primary', 'border-3');
                selectedCard.setAttribute('data-type', 'dynamic');
                medicineGrid.appendChild(selectedCard);

                // Scroll to the medicine card
                selectedCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            } catch (error) {
                console.error('Error loading medicine details:', error);
                alert('Error loading medicine details. Please try again.');
            }
        }

        function filterByCategory() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const selectElement = document.getElementById('medicineSelect');
            const options = selectElement.querySelectorAll('option[data-category]');

            // Reset the medicine selection
            selectElement.value = '';

            // Show/hide options based on category filter
            options.forEach(option => {
                if (!categoryFilter || option.getAttribute('data-category') === categoryFilter) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });

            // If a category is selected, show medicines from that category
            if (categoryFilter) {
                searchMedicinesByCategory(categoryFilter);
            } else {
                showOnlyOTCMedicines();
            }
        }

        function filterBySpecies() {
            const speciesFilter = document.getElementById('speciesFilter').value;
            const selectElement = document.getElementById('medicineSelect');
            const options = selectElement.querySelectorAll('option[data-species]');

            // Reset the medicine selection
            selectElement.value = '';

            // Show/hide options based on species filter
            options.forEach(option => {
                if (!speciesFilter || option.getAttribute('data-species').includes(speciesFilter)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });

            // If a species is selected, show medicines for that species
            if (speciesFilter) {
                searchMedicinesBySpecies(speciesFilter);
            } else {
                showOnlyOTCMedicines();
            }
        }

        async function searchMedicinesByCategory(category) {
            try {
                const response = await fetch(`/api/search/?category=${encodeURIComponent(category)}`);
                const data = await response.json();
                displaySearchResults(data.medicines);
            } catch (error) {
                console.error('Error searching by category:', error);
                showOnlyOTCMedicines();
            }
        }

        async function searchMedicinesBySpecies(species) {
            try {
                const response = await fetch(`/api/search/?species=${encodeURIComponent(species)}`);
                const data = await response.json();
                displaySearchResults(data.medicines);
            } catch (error) {
                console.error('Error searching by species:', error);
                showOnlyOTCMedicines();
            }
        }

        function displaySearchResults(medicines) {
            const medicineGrid = document.querySelector('.row');

            // Hide veterinary cards
            const veterinaryCards = document.querySelectorAll('.medicine-card[data-type="veterinary"]');
            veterinaryCards.forEach(card => {
                card.style.display = 'none';
            });

            // Remove any existing human medicine cards
            const existingHumanCards = document.querySelectorAll('.medicine-card[data-type="human"]');
            existingHumanCards.forEach(card => card.remove());

            // Add search results
            if (medicines && medicines.length > 0) {
                medicines.forEach(medicine => {
                    const card = createHumanMedicineCard(medicine);
                    medicineGrid.appendChild(card);
                });
            } else {
                const noResultsCard = createNoResultsCard('filter criteria');
                medicineGrid.appendChild(noResultsCard);
            }
        }

        // Clear all filters function
        function clearAllFilters() {
            document.getElementById('medicineSelect').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('speciesFilter').value = '';
            document.getElementById('medicineSearch').value = '';
            document.getElementById('addToCartSection').style.display = 'none';
            showOnlyOTCMedicines();
        }

        // Comprehensive Formula Database
        function getComprehensiveFormulaData(medicineName) {
            const formulaDatabase = {
                'Aspirin': {
                    molecularFormula: 'C₉H₈O₄',
                    molecularWeight: '180.16 g/mol',
                    chemicalName: '2-acetoxybenzoic acid (acetylsalicylic acid)',
                    mechanismOfAction: 'Irreversibly inhibits COX-1 and COX-2 enzymes, reducing prostaglandin synthesis',
                    therapeuticClass: 'Nonsteroidal Anti-inflammatory Drug (NSAID) - OTC',
                    routeOfAdmin: 'Oral',
                    absorption: 'Rapidly absorbed from stomach and small intestine, peak levels in 1-2 hours',
                    distribution: 'Highly protein bound (80-90%), crosses blood-brain barrier',
                    metabolism: 'Hepatic metabolism to salicylic acid and other metabolites',
                    elimination: 'Renal elimination, half-life 2-3 hours for low doses',
                    contraindications: 'Active peptic ulcer, children with viral infections (Reye syndrome risk), severe kidney disease',
                    sideEffects: 'Stomach irritation, increased bleeding risk, tinnitus at high doses'
                },
                'Ibuprofen': {
                    molecularFormula: 'C₁₃H₁₈O₂',
                    molecularWeight: '206.28 g/mol',
                    chemicalName: '2-(4-isobutylphenyl)propionic acid',
                    mechanismOfAction: 'Non-selective COX-1 and COX-2 inhibitor, reducing prostaglandin synthesis',
                    therapeuticClass: 'Nonsteroidal Anti-inflammatory Drug (NSAID) - OTC',
                    routeOfAdmin: 'Oral',
                    absorption: 'Rapidly absorbed from GI tract, peak levels in 1-4 hours',
                    distribution: 'Highly protein bound (99%), limited distribution to CNS',
                    metabolism: 'Hepatic metabolism via CYP2C9, glucuronidation',
                    elimination: 'Renal elimination, half-life 2-4 hours',
                    contraindications: 'Active peptic ulcer disease, severe renal/hepatic impairment, aspirin allergy',
                    sideEffects: 'GI upset, take with food to minimize stomach irritation'
                },
                'Acetaminophen': {
                    molecularFormula: 'C₈H₉NO₂',
                    molecularWeight: '151.16 g/mol',
                    chemicalName: 'N-(4-hydroxyphenyl)acetamide',
                    mechanismOfAction: 'Inhibits COX enzymes in CNS, minimal peripheral anti-inflammatory effect',
                    therapeuticClass: 'Analgesic and Antipyretic - OTC',
                    routeOfAdmin: 'Oral, Rectal, Intravenous (prescription only)',
                    absorption: 'Rapidly and completely absorbed from GI tract, peak levels in 30-60 minutes',
                    distribution: 'Minimal protein binding (10-25%), crosses blood-brain barrier',
                    metabolism: 'Primarily hepatic metabolism via glucuronidation and sulfation',
                    elimination: 'Renal excretion, half-life 1-4 hours',
                    contraindications: 'Severe hepatic impairment, chronic alcohol use',
                    sideEffects: 'Very safe when used as directed, hepatotoxicity only with overdose'
                },
                'Vitamin C': {
                    molecularFormula: 'C₆H₈O₆',
                    molecularWeight: '176.12 g/mol',
                    chemicalName: 'L-ascorbic acid',
                    mechanismOfAction: 'Essential cofactor for collagen synthesis, antioxidant, supports immune function',
                    therapeuticClass: 'Water-soluble Vitamin Supplement - OTC',
                    routeOfAdmin: 'Oral',
                    absorption: 'Active transport in small intestine, absorption decreases with higher doses',
                    distribution: 'Widely distributed, high concentrations in adrenal glands, brain, lungs',
                    metabolism: 'Metabolized to oxalate and other metabolites',
                    elimination: 'Renal excretion, excess amounts excreted unchanged',
                    contraindications: 'History of kidney stones (high doses), glucose-6-phosphate dehydrogenase deficiency',
                    sideEffects: 'Generally very safe, high doses may cause GI upset or diarrhea'
                },
                'Multivitamin': {
                    molecularFormula: 'Multiple compounds',
                    molecularWeight: 'Variable',
                    chemicalName: 'Combination of essential vitamins and minerals',
                    mechanismOfAction: 'Provides essential micronutrients for cellular metabolism and physiological functions',
                    therapeuticClass: 'Vitamin and Mineral Supplement - OTC',
                    routeOfAdmin: 'Oral',
                    absorption: 'Variable absorption for different vitamins and minerals',
                    distribution: 'Distributed according to individual vitamin/mineral properties',
                    metabolism: 'Each component metabolized differently',
                    elimination: 'Water-soluble vitamins excreted in urine, fat-soluble vitamins stored',
                    contraindications: 'Iron overload disorders, hypervitaminosis A or D',
                    sideEffects: 'Generally safe, may cause mild nausea if taken on empty stomach'
                },
                'Loratadine': {
                    molecularFormula: 'C₂₂H₂₃ClN₂O₂',
                    molecularWeight: '382.88 g/mol',
                    chemicalName: 'ethyl 4-(8-chloro-5,6-dihydro-11H-benzo[5,6]cyclohepta[1,2-b]pyridin-11-ylidene)-1-piperidinecarboxylate',
                    mechanismOfAction: 'Selective peripheral H1-receptor antagonist, blocks histamine effects',
                    therapeuticClass: 'Second-generation Antihistamine - OTC',
                    routeOfAdmin: 'Oral',
                    absorption: 'Rapidly absorbed, peak levels in 1-3 hours',
                    distribution: 'Extensive tissue distribution, minimal CNS penetration',
                    metabolism: 'Hepatic metabolism via CYP3A4 to active metabolite desloratadine',
                    elimination: 'Renal and biliary excretion, half-life 8-12 hours',
                    contraindications: 'Known hypersensitivity to loratadine',
                    sideEffects: 'Non-drowsy formula, very well tolerated, occasional headache'
                }
            };

            // Return data for the medicine, or default values if not found
            return formulaDatabase[medicineName] || {
                molecularFormula: 'Data not available',
                molecularWeight: 'Data not available',
                chemicalName: 'Chemical name not available for this medicine',
                mechanismOfAction: 'Mechanism of action information not available',
                therapeuticClass: 'Classification information not available',
                routeOfAdmin: 'Administration route not specified',
                absorption: 'Absorption data not available',
                distribution: 'Distribution data not available',
                metabolism: 'Metabolism data not available',
                elimination: 'Elimination data not available',
                contraindications: 'Contraindication information not available',
                sideEffects: 'Side effect information not available'
            };
        }

        // Update add to cart section with selected medicine
        function updateAddToCartSection(medicine) {
            document.getElementById('selectedMedicineName').textContent = medicine.name;
            document.getElementById('selectedMedicineCategory').textContent = medicine.category;
            document.getElementById('selectedMedicineSpecies').textContent = medicine.species_applicable;
            document.getElementById('selectedMedicineDosage').textContent = medicine.dosage;

            // Generate a random price for demonstration (in a real app, this would come from the database)
            const price = (Math.random() * 100 + 10).toFixed(2);
            document.getElementById('selectedMedicinePrice').textContent = price;

            // Get comprehensive formula data
            const formulaData = getComprehensiveFormulaData(medicine.name);

            // Update formula information
            document.getElementById('molecularFormula').textContent = formulaData.molecularFormula;
            document.getElementById('molecularWeight').textContent = formulaData.molecularWeight;
            document.getElementById('chemicalName').textContent = formulaData.chemicalName;
            document.getElementById('mechanismOfAction').textContent = formulaData.mechanismOfAction;
            document.getElementById('therapeuticClass').textContent = formulaData.therapeuticClass;
            document.getElementById('routeOfAdmin').textContent = formulaData.routeOfAdmin;
            document.getElementById('absorption').textContent = formulaData.absorption;
            document.getElementById('distribution').textContent = formulaData.distribution;
            document.getElementById('metabolism').textContent = formulaData.metabolism;
            document.getElementById('elimination').textContent = formulaData.elimination;
            document.getElementById('contraindications').textContent = formulaData.contraindications;
            document.getElementById('sideEffects').textContent = formulaData.sideEffects;

            // Show the add to cart section
            document.getElementById('addToCartSection').style.display = 'block';

            // Store medicine data for cart addition
            window.selectedMedicineData = {
                id: medicine.id,
                name: medicine.name,
                category: medicine.category,
                dosage: medicine.dosage,
                species_applicable: medicine.species_applicable,
                price: parseFloat(price),
                notes: medicine.notes
            };
        }

        // Add selected medicine to cart
        function addSelectedMedicineToCart() {
            if (!window.selectedMedicineData) {
                alert('Please select a medicine first.');
                return;
            }

            const quantity = parseInt(document.getElementById('quantitySelect').value);
            const medicine = window.selectedMedicineData;

            // Check if medicine is already in cart
            const existingItem = cart.find(item => item.id === medicine.id);

            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: medicine.id,
                    name: medicine.name,
                    category: medicine.category,
                    dosage: medicine.dosage,
                    species: medicine.species_applicable,
                    price: medicine.price,
                    quantity: quantity,
                    notes: medicine.notes
                });
            }

            updateCartCount();

            // Show success message
            const successMessage = document.createElement('div');
            successMessage.className = 'alert alert-success alert-dismissible fade show mt-2';
            successMessage.innerHTML = `
                <strong>Success!</strong> ${medicine.name} (${quantity}x) has been added to your cart.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            const addToCartSection = document.getElementById('addToCartSection');
            addToCartSection.appendChild(successMessage);

            // Remove success message after 3 seconds
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.remove();
                }
            }, 3000);
        }

        // Patient Information Functions
        function savePatientInfo() {
            const age = document.getElementById('patientAge').value;
            const weight = document.getElementById('patientWeight').value;
            const weightUnit = document.getElementById('weightUnit').value;
            const height = document.getElementById('patientHeight').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const allergies = document.getElementById('patientAllergies').value;

            // Save to localStorage
            const patientData = {
                age: age,
                weight: weight,
                weightUnit: weightUnit,
                height: height,
                heightUnit: heightUnit,
                allergies: allergies,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('patientInfo', JSON.stringify(patientData));

            // Show success message
            showPatientInfoSaved();

            // Check for safety alerts
            checkSafetyAlerts(patientData);

            // Calculate BMI if height and weight are provided
            if (height && weight) {
                calculateBMI();
            }
        }

        function clearPatientInfo() {
            document.getElementById('patientAge').value = '';
            document.getElementById('patientWeight').value = '';
            document.getElementById('patientHeight').value = '';
            document.getElementById('patientAllergies').value = '';
            document.getElementById('bmiSection').style.display = 'none';
            document.getElementById('safetyAlerts').style.display = 'none';
            localStorage.removeItem('patientInfo');
        }

        function loadPatientInfo() {
            const savedData = localStorage.getItem('patientInfo');
            if (savedData) {
                const patientData = JSON.parse(savedData);
                document.getElementById('patientAge').value = patientData.age || '';
                document.getElementById('patientWeight').value = patientData.weight || '';
                document.getElementById('weightUnit').value = patientData.weightUnit || 'kg';
                document.getElementById('patientHeight').value = patientData.height || '';
                document.getElementById('heightUnit').value = patientData.heightUnit || 'cm';
                document.getElementById('patientAllergies').value = patientData.allergies || '';
            }
        }

        function calculateBMI() {
            const weight = parseFloat(document.getElementById('patientWeight').value);
            const height = parseFloat(document.getElementById('patientHeight').value);
            const weightUnit = document.getElementById('weightUnit').value;
            const heightUnit = document.getElementById('heightUnit').value;

            if (!weight || !height) {
                alert('Please enter both weight and height to calculate BMI.');
                return;
            }

            // Convert to metric units
            let weightKg = weight;
            let heightM = height;

            if (weightUnit === 'lbs') {
                weightKg = weight * 0.453592;
            }

            if (heightUnit === 'ft') {
                heightM = height * 0.3048;
            } else {
                heightM = height / 100; // cm to meters
            }

            // Calculate BMI
            const bmi = weightKg / (heightM * heightM);
            const bmiRounded = Math.round(bmi * 10) / 10;

            // Determine BMI category
            let category, note, alertClass;
            if (bmi < 18.5) {
                category = 'Underweight';
                note = 'May need higher caloric intake and careful medication dosing.';
                alertClass = 'alert-warning';
            } else if (bmi < 25) {
                category = 'Normal weight';
                note = 'Healthy weight range for most medications.';
                alertClass = 'alert-success';
            } else if (bmi < 30) {
                category = 'Overweight';
                note = 'May require dose adjustments for some medications.';
                alertClass = 'alert-warning';
            } else {
                category = 'Obese';
                note = 'Requires careful dose calculations and monitoring for many medications.';
                alertClass = 'alert-danger';
            }

            // Display BMI results
            document.getElementById('bmiValue').textContent = bmiRounded;
            document.getElementById('bmiCategory').textContent = category;
            document.getElementById('bmiNote').textContent = note;
            document.getElementById('bmiSection').style.display = 'block';
            document.getElementById('bmiSection').querySelector('.alert').className = `alert ${alertClass}`;
        }

        function checkSafetyAlerts(patientData) {
            const alerts = [];
            const age = parseInt(patientData.age);
            const allergies = patientData.allergies.toLowerCase();

            // Age-based alerts
            if (age < 18) {
                alerts.push('Pediatric patient: Many medications require special pediatric dosing.');
            }
            if (age >= 65) {
                alerts.push('Geriatric patient: Increased risk of drug interactions and side effects.');
            }

            // Allergy-based alerts
            if (allergies.includes('penicillin')) {
                alerts.push('Penicillin allergy: Avoid all penicillin-based antibiotics.');
            }
            if (allergies.includes('aspirin')) {
                alerts.push('Aspirin allergy: Avoid NSAIDs and salicylates.');
            }
            if (allergies.includes('sulfa')) {
                alerts.push('Sulfa allergy: Avoid sulfonamide antibiotics.');
            }
            if (allergies.includes('iodine')) {
                alerts.push('Iodine allergy: Use caution with contrast agents and some antiseptics.');
            }

            // Display alerts if any
            if (alerts.length > 0) {
                const alertsList = document.getElementById('alertsList');
                alertsList.innerHTML = '';
                alerts.forEach(alert => {
                    const li = document.createElement('li');
                    li.textContent = alert;
                    alertsList.appendChild(li);
                });
                document.getElementById('safetyAlerts').style.display = 'block';
            } else {
                document.getElementById('safetyAlerts').style.display = 'none';
            }
        }

        function showPatientInfoSaved() {
            const successMessage = document.createElement('div');
            successMessage.className = 'alert alert-success alert-dismissible fade show position-fixed';
            successMessage.style.top = '20px';
            successMessage.style.right = '20px';
            successMessage.style.zIndex = '9999';
            successMessage.innerHTML = `
                <strong><i class="fas fa-check-circle"></i> Patient Information Saved!</strong>
                <br>Your information will be used for personalized recommendations.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(successMessage);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.remove();
                }
            }, 4000);
        }

        // Load patient info on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadPatientInfo();
        });
    </script>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Comparative Medicine Database</h5>
                    <p class="mb-0">Your trusted source for comparative medicine information.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6>Quick Links</h6>
                    <div class="footer-links">
                        <a href="#" class="text-light me-3" data-bs-toggle="modal" data-bs-target="#aboutModal">About
                            Us</a>
                        <a href="#" class="text-light me-3" data-bs-toggle="modal"
                            data-bs-target="#contactModal">Contact</a>
                        <a href="#" class="text-light me-3" data-bs-toggle="modal" data-bs-target="#helpModal">Help</a>
                        <a href="#" class="text-light" data-bs-toggle="modal" data-bs-target="#termsModal">Terms &
                            Conditions</a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 text-muted">
                        &copy; 2025 Comparative Medicine Database. All rights reserved.
                        | <a href="#" class="text-light" data-bs-toggle="modal" data-bs-target="#termsModal">Terms &
                            Conditions</a>
                        | For educational purposes only.
                    </p>
                </div>
            </div>
        </div>
    </footer>

</body>

</html>